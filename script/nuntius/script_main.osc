'################################
'Trigger section
'################################

' triggers if the driverCard was put on the device
{trigger:nuntius_driverCard_get}
	1 (S.L.nuntius_driverCard)

'if we are at the welcome page, go to the login page
	(L.L.nuntius_printer_page) 0 =
	{if}
		1 (M.L.nuntius_printer_goToPage)
	{endif}

'if we are at the break page, go to login from break
	(L.L.nuntius_printer_page) 7 =
	{if}
		71 (M.L.nuntius_printer_goToPage)
	{endif}
{end}

'triggers if the driverCard was removed from the device
{trigger:nuntius_driverCard_put}
	0 (S.L.nuntius_driverCard)

'if we are at the login page, go back to the welcome page
	(L.L.nuntius_printer_page) 1 =
	{if}
		(M.L.nuntius_printer_resetInputFields)
		0 (M.L.nuntius_printer_goToPage)
	{endif}

'if we are at the login from break page, go back to the break page
	(L.L.nuntius_printer_page) 71 =
	{if}
		(M.L.nuntius_printer_resetInputFields)
		7 (M.L.nuntius_printer_goToPage)
	{endif}
{end}

'triggers if the printed ticket was clicked to remove it e.g.
{trigger:nuntius_ticket}
	0 (S.L.nuntius_ticket) (S.L.nuntius_ticketAnim) (S.L.nuntius_ticketPrinting) (S.L.nuntius_ticketPrintingTimer)
	-1 (S.L.GivenTicket) (S.L.nuntius_printer_givenTicket)
{end}

'triggers if the apply-button was clicked
{trigger:nuntius_printer_apply}
	(M.L.nuntius_printer_apply)
{end}

'triggers if the reset-button was clicked
{trigger:nuntius_printer_reset}
	(M.L.nuntius_printer_reset)
{end}

'triggers if the auto-button was clicked
{trigger:nuntius_printer_auto}
	(M.L.nuntius_printer_auto)
{end}

'triggers if the menu-button was clicked
{trigger:nuntius_printer_menu}
	(L.L.nuntius_printer_page) 20 =
	{if}
		2 (M.L.nuntius_printer_goToPage)
	{else}
		20 (M.L.nuntius_printer_goToPage)
	{endif}
	(M.L.nuntius_printer_playSoundNormal)
{end}

'triggers if the switch-main-busston-menu-button was clicked
{trigger:nuntius_printer_busstopMenu}
'if we are at the home page, go to busstop
	(L.L.nuntius_printer_page) 2 =
	{if}
		3 (M.L.nuntius_printer_goToPage)
'play sound
		(M.L.nuntius_printer_playSoundNormal)
	{else}
'if we are at the busstop page, go to home page
		(L.L.nuntius_printer_page) 3 =
		{if}
			2 (M.L.nuntius_printer_goToPage)
'play sound
			(M.L.nuntius_printer_playSoundNormal)
		{endif}
	{endif}

'Announcements page
	(L.L.nuntius_printer_page) 6 =
	{if}
		3 (M.L.nuntius_printer_goToPage)
		(M.L.nuntius_printer_playSoundNormal)
	{endif}
{end}

{trigger:nuntius_printer_busstopDown}
	-1 (M.L.nuntius_printer_busstopJump)
{end}

{trigger:cp_microphone}
	1 (M.L.nuntius_printer_busstopJump)
{end}

{trigger:nuntius_printer_jumpToBusstop2}
	2 (M.L.nuntius_printer_busstopJump)
{end}

{trigger:nuntius_printer_jumpToBusstop3}
	3 (M.L.nuntius_printer_busstopJump)
{end}

{trigger:nuntius_printer_jumpToBusstop4}
	4 (M.L.nuntius_printer_busstopJump)
{end}

'Route-menu
{trigger:IBIS_setmode_linie_kurs}
	(L.L.nuntius_printer_page) 2 = 
	{if}
		4 (M.L.nuntius_printer_goToPage)
		(M.L.nuntius_printer_playSoundNormal)
	{endif}
{end}

'Terminus-Menu
{trigger:IBIS_setmode_ziel}
	(L.L.nuntius_printer_page) 2 = 
	{if}
		5 (M.L.nuntius_printer_goToPage)
		(M.L.nuntius_printer_playSoundNormal)
	{endif}
{end}

'AutoHFS-toggle
{trigger:nuntius_printer_homeButton2}
	(L.L.nuntius_printer_page) 2 = (L.L.nuntius_printer_RouteMode) &&
	{if}
		(M.L.nuntius_printer_toggleAutoHFS)
	{endif}
{end}

'Announcements menu
{trigger:nuntius_printer_homeButton3}
	6 (M.L.nuntius_printer_goToPage)
	(M.L.nuntius_printer_playSoundNormal)
{end}

'Break Menu
{trigger:nuntius_printer_homeButton4}
	(L.L.nuntius_printer_page) 2 = (L.L.nuntius_printer_page) 3 = ||
	{if}
		(L.L.nuntius_printer_hasHofFileOptions)
		{if}
			(M.L.nuntius_printer_startBreak)
		{endif}
		7 (M.L.nuntius_printer_goToPage)
		(M.L.nuntius_printer_playSoundNormal)
	{endif}
{end}

'"Funk" Menu
{trigger:nuntius_printer_homeButton5}
{end}

'Driver switch menu
{trigger:nuntius_printer_homeButton6}
	(L.L.nuntius_printer_page) 2 = 
	{if}
		9 (M.L.nuntius_printer_goToPage)
		(M.L.nuntius_printer_playSoundNormal)
	{endif}
{end}

'Shift end menu
{trigger:nuntius_printer_homeButton7}
	(L.L.nuntius_printer_page) 2 = 
	{if}
		10 (M.L.nuntius_printer_goToPage)
		(M.L.nuntius_printer_playSoundNormal)
	{endif}
{end}

{trigger:nuntius_printer_busstopPause}
	(L.L.nuntius_printer_page) 2 = (L.L.nuntius_printer_page) 3 = ||
	{if}
		(L.L.nuntius_printer_hasHofFileOptions)
		{if}
			(M.L.nuntius_printer_startBreak)
		{endif}
		7 (M.L.nuntius_printer_goToPage)
		(M.L.nuntius_printer_playSoundNormal)
	{endif}
{end}

{trigger:nuntius_printer_ticket0}
	0 (M.L.nuntius_printer_selectTicket)
{end}

{trigger:nuntius_printer_ticket1}
	1 (M.L.nuntius_printer_selectTicket)
{end}

{trigger:nuntius_printer_ticket2}
	2 (M.L.nuntius_printer_selectTicket)
{end}

{trigger:nuntius_printer_ticket3}
	3 (M.L.nuntius_printer_selectTicket)
{end}

{trigger:nuntius_printer_ticket4}
	4 (M.L.nuntius_printer_selectTicket)
{end}

{trigger:nuntius_printer_ticket5}
	5 (M.L.nuntius_printer_selectTicket)
{end}

{trigger:nuntius_printer_ticket6}
	6 (M.L.nuntius_printer_selectTicket)
{end}

{trigger:nuntius_printer_ticket7}
	7 (M.L.nuntius_printer_selectTicket)
{end}

{trigger:nuntius_printer_bar}
	(M.L.nuntius_printer_barTicket)
{end}

{trigger:nuntius_printer_cTicket}
	3 (M.L.nuntius_printer_goToPage)
	(M.L.nuntius_printer_playSoundNormal)
{end}

{trigger:nuntius_printer_storno}
	(M.L.nuntius_printer_cancelTicket)
{end}

{trigger:nuntius_printer_back}
	(M.L.nuntius_printer_back)
{end}

{trigger:IBIS_0}
	0 (M.L.nuntius_printer_numpadButton)
{end}

{trigger:IBIS_1}
	1 (M.L.nuntius_printer_numpadButton)
{end}

{trigger:IBIS_2}
	2 (M.L.nuntius_printer_numpadButton)
{end}

{trigger:IBIS_3}
	3 (M.L.nuntius_printer_numpadButton)
{end}

{trigger:IBIS_4}
	4 (M.L.nuntius_printer_numpadButton)
{end}

{trigger:IBIS_5}
	5 (M.L.nuntius_printer_numpadButton)
{end}

{trigger:IBIS_6}
	6 (M.L.nuntius_printer_numpadButton)
{end}

{trigger:IBIS_7}
	7 (M.L.nuntius_printer_numpadButton)
{end}

{trigger:IBIS_8}
	8 (M.L.nuntius_printer_numpadButton)
{end}

{trigger:IBIS_9}
	9 (M.L.nuntius_printer_numpadButton)
{end}

{trigger:IBIS_loeschen}
	10 (M.L.nuntius_printer_numpadButton)
{end}

{trigger:IBIS_eingabe}
	(M.L.nuntius_printer_numpadEnter)
{end}

{trigger:nuntius_printer_input0}
	0 (M.L.nuntius_printer_focusInputField)
{end}

{trigger:nuntius_printer_input1}
	1 (M.L.nuntius_printer_focusInputField)
{end}

{trigger:nuntius_printer_input2}
	2 (M.L.nuntius_printer_focusInputField)
{end}

{trigger:nuntius_printer_announcement0}
	0 (M.L.nuntius_printer_playSpecialAnnouncement)
{end}

{trigger:nuntius_printer_announcement1}
	1 (M.L.nuntius_printer_playSpecialAnnouncement)
{end}

{trigger:nuntius_printer_announcement2}
	2 (M.L.nuntius_printer_playSpecialAnnouncement)
{end}

{trigger:nuntius_printer_announcement3}
	3 (M.L.nuntius_printer_playSpecialAnnouncement)
{end}

{trigger:nuntius_printer_announcementsOnOff}
	(L.L.nuntius_printer_AnnouncementsAreActive) ! (S.L.nuntius_printer_AnnouncementsAreActive)
	6 (M.L.nuntius_printer_goToPage)
	(M.L.nuntius_printer_playSoundNormal)
{end}

{trigger:nuntius_printer_menuItem0}
{end}

{trigger:nuntius_printer_menuItem1}
{end}

{trigger:nuntius_printer_menuItem2}
{end}

{trigger:nuntius_printer_menuItem3}
{end}

{trigger:nuntius_printer_menuAppearanceThemeAuto}
	0 (S.L.nuntius_printer_colorSchemeSetting)
	(M.L.nuntius_printer_updateColorScheme)
	20 (M.L.nuntius_printer_goToPage)
	(M.L.nuntius_printer_playSoundNormal)
{end}

{trigger:nuntius_printer_menuAppearanceThemeLight}
	1 (S.L.nuntius_printer_colorSchemeSetting)
	"nuntius\ui_default_light\" (S.$.nuntius_printer_currentDisplayTextureFolder)
	20 (M.L.nuntius_printer_goToPage)
	(M.L.nuntius_printer_playSoundNormal)
{end}

{trigger:nuntius_printer_menuAppearanceThemeDark}
	2 (S.L.nuntius_printer_colorSchemeSetting)
	"nuntius\ui_default_dark\" (S.$.nuntius_printer_currentDisplayTextureFolder)
	20 (M.L.nuntius_printer_goToPage)
	(M.L.nuntius_printer_playSoundNormal)
{end}

{trigger:nuntius_printer_menuAppearanceBrightnessIncrease}
	(L.L.nuntius_printer_displayBrightnessPercent) 20 + 100 min (S.L.nuntius_printer_displayBrightnessPercent)
	1 (L.L.nuntius_printer_displayBrightnessPercent) 100 / - (S.L.nuntius_printer_displayBrightnessFloat)

	(M.L.nuntius_printer_scheduleScriptTextForUpdate)
	(M.L.nuntius_printer_playSoundNormal)
{end}

{trigger:nuntius_printer_menuAppearanceBrightnessDecrease}
	(L.L.nuntius_printer_displayBrightnessPercent) 20 - 0 max (S.L.nuntius_printer_displayBrightnessPercent)
	1 (L.L.nuntius_printer_displayBrightnessPercent) 100 / - (S.L.nuntius_printer_displayBrightnessFloat)

	(M.L.nuntius_printer_scheduleScriptTextForUpdate)
	(M.L.nuntius_printer_playSoundNormal)
{end}


'################################
'General
'################################

{macro:nuntius_printer_init}
	(L.$.nuntius_printer_currentDisplayTextureFolder) "Black.dds" $+ (S.$.nuntius_printer_ui_texture)


'execute Daueranimation
	(M.L.nuntius_printer_executeDaueranimation)

	(M.L.nuntius_printer_initFonts)
	(M.L.nuntius_printer_scheduleScriptTextForUpdate)

'init brightness
	100 (S.L.nuntius_printer_displayBrightnessPercent)
{end}

{macro:nuntius_printer_frame}
'debug
	(C.L.nuntius_debugMode)
	{if}
		(M.L.nuntius_printer_executeDaueranimation)
		(M.L.nuntius_printer_initFonts)
	{endif}

'API calls
'Zeros are fallback. If the macro is empty or not defined, we will always take zero and avoid undefined behavior.
	0 (M.L.nuntius_input_power) (S.L.nuntius_input_power)
	0 (M.L.nuntius_input_doorsOpen) (S.L.nuntius_input_doorsOpen)

'Event loop
	(M.L.nuntius_printer_eventLoop)

'Update colorscheme
	(M.L.nuntius_printer_updateColorScheme)

	(M.L.nuntius_printer_refreshDelay)
	(M.L.nuntius_printer_bootHandler)
	(M.L.nuntius_printer_autoOpenBusstopPage)
	(M.L.nuntius_printer_autoOpenDeparturePage)
	(M.L.nuntius_printer_autoOpenConfirmNextTripPage)
	(M.L.nuntius_printer_autoSetTripEndTerminus)
	(M.L.nuntius_printer_updateCurrentBusstopIndex)
	(M.L.nuntius_printer_recalculateDistance)
	(M.L.nuntius_updateTicket)
	(M.L.nuntius_ticketPrintHandler)
	(M.L.nuntius_printer_updateWaitTimer)

'Refresh Strings
	1 (S.L.Refresh_Strings)

'Render Script texture
	(L.L.nuntius_printer_screenIsOn)
	{if}
		(L.L.nuntius_printer_scriptTextureState) 1 - ! 1 + (S.L.nuntius_printer_scriptTextureState)

		1 =
		{if} (C.L.nuntius_printer_scriptTextureIndex1) {else} (C.L.nuntius_printer_scriptTextureIndex2) {endif}
		(S.L.nuntius_printer_scriptTextureCurrentIndex)

		(L.L.nuntius_printer_updateScriptTexture)
		{if}
			1 - (S.L.nuntius_printer_updateScriptTexture)
			(M.L.nuntius_printer_renderScriptTexture)
		{else}
			(M.L.nuntius_printer_updateScriptTextureFrame)
		{endif}
	{endif}
{end}

'Event loop to process events and update the api data
{macro:nuntius_printer_eventLoop}
'Clock Time
	(L.S.Time) 3600 / trunc s1
	(L.S.Time) 3600 % 60 / trunc s2

	l1 "02" $IntToStrEnh ":" $+ l2 "02" $IntToStrEnh $+
	(S.$.nuntius_output_timeString)

'Pause
	(L.L.nuntius_printer_page) 7 = 
	(L.L.nuntius_printer_page) 71 = ||
	(L.L.nuntius_output_pauseActive) ! &&
	{if} (S.L.nuntius_event_queue_pauseChanged) {endif}

	(L.L.nuntius_printer_page) 7 = ! 
	(L.L.nuntius_printer_page) 71 = ! &&
	(L.L.nuntius_output_pauseActive) &&
	{if} (S.L.nuntius_event_queue_pauseChanged) {endif}

'Route Mode
	(L.L.nuntius_printer_RouteMode) (L.L.nuntius_output_routeMode) = !
	{if} 
		(L.L.nuntius_printer_RouteMode) (S.L.nuntius_output_routeMode)
		1 (S.L.nuntius_event_queue_routeModeChanged)
	{endif}

'Line
	(L.L.nuntius_printer_Line) (L.L.nuntius_output_lineNumber) = !
	(L.L.nuntius_printer_Suffix) (L.L.nuntius_output_lineSuffix) = ! ||
	{if}
		(L.L.nuntius_printer_RouteMode) 1 =
		{if}
			(L.L.nuntius_printer_Line) (S.L.nuntius_output_lineNumber)
			(L.L.nuntius_printer_Suffix) (S.L.nuntius_output_lineSuffix)
		{else}
			0 (S.L.nuntius_output_lineNumber) (S.L.nuntius_output_lineSuffix)
		{endif}
		1 (S.L.nuntius_event_queue_lineChanged)
	{endif}

	(L.$.nuntius_printer_lineStr) (L.$.nuntius_output_lineString) $= !
	{if}
		(L.$.nuntius_printer_lineStr) (S.$.nuntius_output_lineString)
		1 (S.L.nuntius_event_queue_lineChanged)
	{endif}

'Terminus
	(L.L.nuntius_printer_TerminusIndex) (L.L.nuntius_output_terminusIndex) = !
	{if}
		(L.L.nuntius_printer_TerminusIndex) (S.L.nuntius_output_terminusIndex)
		5 (M.V.GetTerminusString) (S.$.nuntius_output_terminusString)
		1 (S.L.nuntius_event_queue_terminusChanged)
	{endif}

'Combined Line and Terminus
	(L.$.nuntius_output_lineString) " " $+ (L.$.nuntius_output_terminusString) $+ (S.$.nuntius_output_lineTerminusString)
	
'Busstops
	(L.L.nuntius_printer_RouteMode) 0 = !
	{if}
		0 (M.L.nuntius_printer_getBusstopListEntry) (L.L.nuntius_output_busstopIndex0) (L.$.nuntius_output_busstopString0) = ! $= ! ||
		{if} 1 (S.L.nuntius_event_queue_currentBusstopChanged) {endif}

		0 (M.L.nuntius_printer_getBusstopListEntry) (S.L.nuntius_output_busstopIndex0) s3
		l3 1 (M.L.nuntius_printer_getBusstopIndexString) (S.$.nuntius_output_busstopString0first) " "
		l3 2 (M.L.nuntius_printer_getBusstopIndexString) (S.$.nuntius_output_busstopString0second)
		$+ $+ (S.$.nuntius_output_busstopString0)

		1 (M.L.nuntius_printer_getBusstopListEntry) (S.L.nuntius_output_busstopIndex1) s3
		l3 1 (M.L.nuntius_printer_getBusstopIndexString) (S.$.nuntius_output_busstopString1first) " "
		l3 2 (M.L.nuntius_printer_getBusstopIndexString) (S.$.nuntius_output_busstopString1second)
		$+ $+ (S.$.nuntius_output_busstopString1)

		2 (M.L.nuntius_printer_getBusstopListEntry) (S.L.nuntius_output_busstopIndex2) s3
		l3 1 (M.L.nuntius_printer_getBusstopIndexString) (S.$.nuntius_output_busstopString2first) " "
		l3 2 (M.L.nuntius_printer_getBusstopIndexString) (S.$.nuntius_output_busstopString2second)
		$+ $+ (S.$.nuntius_output_busstopString2)

		3 (M.L.nuntius_printer_getBusstopListEntry) (S.L.nuntius_output_busstopIndex3) s3
		l3 1 (M.L.nuntius_printer_getBusstopIndexString) (S.$.nuntius_output_busstopString3first) " "
		l3 2 (M.L.nuntius_printer_getBusstopIndexString) (S.$.nuntius_output_busstopString3second)
		$+ $+ (S.$.nuntius_output_busstopString3)

		4 (M.L.nuntius_printer_getBusstopListEntry) (S.L.nuntius_output_busstopIndex4) s3
		l3 1 (M.L.nuntius_printer_getBusstopIndexString) (S.$.nuntius_output_busstopString4first) " "
		l3 2 (M.L.nuntius_printer_getBusstopIndexString) (S.$.nuntius_output_busstopString4second)
		$+ $+ (S.$.nuntius_output_busstopString4)

		5 (M.L.nuntius_printer_getBusstopListEntry) (S.L.nuntius_output_busstopIndex5) s3
		l3 1 (M.L.nuntius_printer_getBusstopIndexString) (S.$.nuntius_output_busstopString5first) " "
		l3 2 (M.L.nuntius_printer_getBusstopIndexString) (S.$.nuntius_output_busstopString5second)
		$+ $+ (S.$.nuntius_output_busstopString5)

		6 (M.L.nuntius_printer_getBusstopListEntry) (S.L.nuntius_output_busstopIndex6) s3
		l3 1 (M.L.nuntius_printer_getBusstopIndexString) (S.$.nuntius_output_busstopString6first) " "
		l3 2 (M.L.nuntius_printer_getBusstopIndexString) (S.$.nuntius_output_busstopString6second)
		$+ $+ (S.$.nuntius_output_busstopString6)

		7 (M.L.nuntius_printer_getBusstopListEntry) (S.L.nuntius_output_busstopIndex7) s3
		l3 1 (M.L.nuntius_printer_getBusstopIndexString) (S.$.nuntius_output_busstopString7first) " "
		l3 2 (M.L.nuntius_printer_getBusstopIndexString) (S.$.nuntius_output_busstopString7second)
		$+ $+ (S.$.nuntius_output_busstopString7)

	{else}
		-1
		(S.L.nuntius_output_busstopIndex0)
		(S.L.nuntius_output_busstopIndex1)
		(S.L.nuntius_output_busstopIndex2)
		(S.L.nuntius_output_busstopIndex3)
		(S.L.nuntius_output_busstopIndex4)
		(S.L.nuntius_output_busstopIndex5)
		(S.L.nuntius_output_busstopIndex6)
		(S.L.nuntius_output_busstopIndex7)

		""
		(S.$.nuntius_output_lineString)
		(S.$.nuntius_output_terminusString)

		(S.$.nuntius_output_busstopString0) (S.$.nuntius_output_busstopString1) (S.$.nuntius_output_busstopString2) (S.$.nuntius_output_busstopString3) (S.$.nuntius_output_busstopString4) (S.$.nuntius_output_busstopString5) (S.$.nuntius_output_busstopString6) (S.$.nuntius_output_busstopString7)
		(S.$.nuntius_output_busstopString0first) (S.$.nuntius_output_busstopString1first) (S.$.nuntius_output_busstopString2first) (S.$.nuntius_output_busstopString3first) (S.$.nuntius_output_busstopString4first) (S.$.nuntius_output_busstopString5first) (S.$.nuntius_output_busstopString6first) (S.$.nuntius_output_busstopString7first)
		(S.$.nuntius_output_busstopString0second) (S.$.nuntius_output_busstopString1second) (S.$.nuntius_output_busstopString2second) (S.$.nuntius_output_busstopString3second) (S.$.nuntius_output_busstopString4second) (S.$.nuntius_output_busstopString5second) (S.$.nuntius_output_busstopString6second) (S.$.nuntius_output_busstopString7second)
	{endif}

'Fire event slots
	(L.L.nuntius_event_queue_currentBusstopChanged) {if} (M.L.nuntius_event_currentBusstopChanged)                              {endif}
	(L.L.nuntius_event_queue_routeModeChanged)      {if} (L.L.nuntius_output_routeMode) (M.L.nuntius_event_routeModeChanged)    {endif}
	(L.L.nuntius_event_queue_terminusChanged)       {if} (L.L.nuntius_output_terminusIndex) (M.L.nuntius_event_terminusChanged) {endif}
	(L.L.nuntius_event_queue_lineChanged)           {if} (M.L.nuntius_event_lineChanged)                                        {endif}
	(L.L.nuntius_event_queue_pauseChanged)          {if} (L.L.nuntius_output_pauseActive) (M.L.nuntius_event_pauseChanged)      {endif}

'Reset queues
	0
	(S.L.nuntius_event_queue_currentBusstopChanged)
	(S.L.nuntius_event_queue_routeModeChanged)
	(S.L.nuntius_event_queue_terminusChanged)
	(S.L.nuntius_event_queue_lineChanged)
	(S.L.nuntius_event_queue_pauseChanged)
{end}

{macro:nuntius_printer_updateWaitTimer}
	(L.L.nuntius_printer_pleaseWaitTimer) -1 = !
	{if}
		(L.L.nuntius_printer_pleaseWaitTimer) (L.S.Timegap) + (S.L.nuntius_printer_pleaseWaitTimer)
		(L.L.nuntius_printer_pleaseWaitDuration) >=
		{if}
			-1 (S.L.nuntius_printer_pleaseWaitTimer) (S.L.nuntius_printer_pleaseWaitDuration)

			(L.L.nuntius_printer_pleaseWaitReason) -1 = {if} (L.L.nuntius_printer_targetPage) (M.L.nuntius_printer_goToPage) {endif}
			(L.L.nuntius_printer_pleaseWaitReason) 1  = {if} (M.L.nuntius_printer_checkLogin) {endif}
			(L.L.nuntius_printer_pleaseWaitReason) 2  = {if} (M.L.nuntius_printer_checkLoginAfterBreak) {endif}

			(M.L.nuntius_printer_scheduleScriptTextForUpdate)
		{endif}
	{endif}
{end}

{macro:nuntius_printer_executeDaueranimation}
	(C.L.nuntius_printerPositionX) (S.L.nuntius_daueranimationX)
	(C.L.nuntius_printerPositionY) (S.L.nuntius_daueranimationY)
	(C.L.nuntius_printerPositionZ) (S.L.nuntius_daueranimationZ)
	(C.L.nuntius_printerRotation)  (S.L.nuntius_daueranimationRotation)
{end}

'makes the printed ticket invisible and resets the animation, after the passenger took it
{macro:nuntius_updateTicket}
'if the given ticket is -1 (passanger, took the ticket),
'but the nuntius given ticket is still != -1 (there is still a ticket set)
'and we are not printing currently
	(L.L.GivenTicket) -1 =
	(L.L.nuntius_printer_givenTicket) -1 = ! &&
	(L.L.nuntius_ticketPrinting) ! &&
	{if}
		0 (S.L.nuntius_ticket) (S.L.nuntius_ticketAnim) (S.L.nuntius_ticketPrinting) (S.L.nuntius_ticketPrintingTimer)
		-1 (S.L.nuntius_printer_givenTicket)
	{endif}
{end}


'################################
'Scripttextures
'################################

{macro:nuntius_printer_initFonts}
	"Ubuntu 28px Regular" (M.V.GetFontIndex) (S.L.nuntius_printer_font_28pxRegular)
	"Ubuntu 38px Regular" (M.V.GetFontIndex) (S.L.nuntius_printer_font_38pxRegular)
	"Ubuntu 46px Medium"  (M.V.GetFontIndex) (S.L.nuntius_printer_font_48pxMedium)
	"Ubuntu 38px Medium"  (M.V.GetFontIndex) (S.L.nuntius_printer_font_38pxMedium)
	"Ubuntu 72px Regular" (M.V.GetFontIndex) (S.L.nuntius_printer_font_72pxRegular)
{end}

{macro:nuntius_printer_updateScriptTextureFrame}
	(L.L.nuntius_printer_scriptTextureCurrentIndex) (M.V.STLock)

'Erase
	(L.L.nuntius_printer_scriptTextureCurrentIndex) 0 0 0 0 (M.V.STSetColor)
'Date/Time
	(L.L.nuntius_printer_scriptTextureCurrentIndex) 770 0 1024 76 (M.V.STDrawRect)
'Distance
	(L.L.nuntius_printer_scriptTextureCurrentIndex) 142 499 436 574 (M.V.STDrawRect)

'Rewrite
	(L.L.nuntius_printer_scriptTextureCurrentIndex) 255 255 0 0 (M.V.STSetColor)
	(M.L.nuntius_printer_renderScriptTextureFrame)
	(L.L.nuntius_printer_scriptTextureCurrentIndex) (M.V.STUnlock)
	(L.L.nuntius_printer_scriptTextureCurrentIndex) (M.V.STFilter)
	(L.L.nuntius_printer_scriptTextureCurrentIndex) (M.V.STLock)
	(L.L.nuntius_printer_scriptTextureCurrentIndex) (M.V.STUnlock)
	(L.L.nuntius_printer_scriptTextureCurrentIndex) (M.V.STFilter)
{end}

{macro:nuntius_printer_renderScriptTexture}
	(L.L.nuntius_printer_scriptTextureCurrentIndex) (M.V.STNewTex)
	(L.L.nuntius_printer_scriptTextureCurrentIndex) (M.V.STLock)

	(L.L.nuntius_printer_scriptTextureCurrentIndex) 255 255 0 0 (M.V.STSetColor)

	(M.L.nuntius_printer_renderScriptTextureFrame)

'******************************************
' Line Information
'******************************************
	(L.L.nuntius_printer_visLineInformation) (L.L.nuntius_printer_RouteMode) 0 = ! &&
	{if}
' Note:     ST Index                                    X    Y Font                               Full Sperrpx      Text			
' First line line
		(L.L.nuntius_printer_scriptTextureCurrentIndex) 4    0 (L.L.nuntius_printer_font_38pxMedium) 1 0 (L.$.nuntius_printer_ui_line1) (M.V.STTextOut)
' Second line line
		(L.L.nuntius_printer_scriptTextureCurrentIndex) 4   38 (L.L.nuntius_printer_font_38pxMedium) 1 0 (L.$.nuntius_printer_ui_line2) (M.V.STTextOut)
	{endif}

	(L.L.nuntius_printer_visLineInformation)
	{if}
' First line terminus
		(L.L.nuntius_printer_scriptTextureCurrentIndex) 142  0 (L.L.nuntius_printer_font_38pxRegular) 1 0 (L.$.nuntius_printer_ui_terminus1) (M.V.STTextOut)
' Second line terminus
		(L.L.nuntius_printer_scriptTextureCurrentIndex) 142 38 (L.L.nuntius_printer_font_38pxRegular) 1 0 (L.$.nuntius_printer_ui_terminus2) (M.V.STTextOut)
	{endif}

'******************************************
' Input Fields
'******************************************
	(L.$.nuntius_printer_ui_input0)
	(L.L.nuntius_printer_visInput0) (L.L.nuntius_printer_inputsCensored) 2 % 1 = && {if} $length "*" $* {endif}
	(L.L.nuntius_printer_visInput0)
	{if} (L.L.nuntius_printer_scriptTextureCurrentIndex) 24 128 (L.L.nuntius_printer_font_72pxRegular) 1 0 (M.V.STTextOut) {endif}

	(L.$.nuntius_printer_ui_input1)
	(L.L.nuntius_printer_visInput1) (L.L.nuntius_printer_inputsCensored) 4 % 2 >= && {if} $length "*" $* {endif}
	(L.L.nuntius_printer_visInput1)
	{if} (L.L.nuntius_printer_scriptTextureCurrentIndex) 24 261 (L.L.nuntius_printer_font_72pxRegular) 1 0 (M.V.STTextOut) {endif}

	(L.$.nuntius_printer_ui_input2)
	(L.L.nuntius_printer_visInput2) (L.L.nuntius_printer_inputsCensored) 4 >= && {if} $length "*" $* {endif}
	(L.L.nuntius_printer_visInput2)
	{if} (L.L.nuntius_printer_scriptTextureCurrentIndex) 24 394 (L.L.nuntius_printer_font_72pxRegular) 1 0 (M.V.STTextOut) {endif}


'******************************************
' Loading Info
'******************************************
	(L.L.nuntius_printer_visLoadingInfo)
	{if}
		(L.$.nuntius_printer_ui_loadingInfo) (L.L.nuntius_printer_font_38pxRegular) (M.V.TextLength) s0
		(L.L.nuntius_printer_scriptTextureCurrentIndex) 256 l0 2 / trunc - 436 (L.L.nuntius_printer_font_38pxRegular) 1 0 (L.$.nuntius_printer_ui_loadingInfo) (M.V.STTextOut)
	{endif}

'******************************************
' Tickets
'******************************************
	(L.L.nuntius_printer_visTicketList)
	{if}
		(L.L.nuntius_printer_scriptTextureCurrentIndex) 546  90 (L.L.nuntius_printer_font_38pxRegular) 1 0 (L.$.nuntius_printer_ui_ticketName0)  (M.V.STTextOut)
		(L.L.nuntius_printer_scriptTextureCurrentIndex) 788  90 (L.L.nuntius_printer_font_38pxRegular) 1 0 (L.$.nuntius_printer_ui_ticketName1)  (M.V.STTextOut)
		(L.L.nuntius_printer_scriptTextureCurrentIndex) 546 196 (L.L.nuntius_printer_font_38pxRegular) 1 0 (L.$.nuntius_printer_ui_ticketName2)  (M.V.STTextOut)
		(L.L.nuntius_printer_scriptTextureCurrentIndex) 788 196 (L.L.nuntius_printer_font_38pxRegular) 1 0 (L.$.nuntius_printer_ui_ticketName3)  (M.V.STTextOut)
		(L.L.nuntius_printer_scriptTextureCurrentIndex) 546 302 (L.L.nuntius_printer_font_38pxRegular) 1 0 (L.$.nuntius_printer_ui_ticketName4)  (M.V.STTextOut)
		(L.L.nuntius_printer_scriptTextureCurrentIndex) 788 302 (L.L.nuntius_printer_font_38pxRegular) 1 0 (L.$.nuntius_printer_ui_ticketName5)  (M.V.STTextOut)
		(L.L.nuntius_printer_scriptTextureCurrentIndex) 546 408 (L.L.nuntius_printer_font_38pxRegular) 1 0 (L.$.nuntius_printer_ui_ticketName6)  (M.V.STTextOut)
		(L.L.nuntius_printer_scriptTextureCurrentIndex) 788 408 (L.L.nuntius_printer_font_38pxRegular) 1 0 (L.$.nuntius_printer_ui_ticketName7)  (M.V.STTextOut)

		(L.$.nuntius_printer_ui_ticketPrice0) (L.L.nuntius_printer_font_38pxRegular) (M.V.TextLength) s0
		(L.$.nuntius_printer_ui_ticketPrice1) (L.L.nuntius_printer_font_38pxRegular) (M.V.TextLength) s1
		(L.$.nuntius_printer_ui_ticketPrice2) (L.L.nuntius_printer_font_38pxRegular) (M.V.TextLength) s2
		(L.$.nuntius_printer_ui_ticketPrice3) (L.L.nuntius_printer_font_38pxRegular) (M.V.TextLength) s3
		(L.$.nuntius_printer_ui_ticketPrice4) (L.L.nuntius_printer_font_38pxRegular) (M.V.TextLength) s4
		(L.$.nuntius_printer_ui_ticketPrice5) (L.L.nuntius_printer_font_38pxRegular) (M.V.TextLength) s5
		(L.$.nuntius_printer_ui_ticketPrice6) (L.L.nuntius_printer_font_38pxRegular) (M.V.TextLength) s6
		(L.$.nuntius_printer_ui_ticketPrice7) (L.L.nuntius_printer_font_38pxRegular) (M.V.TextLength) s7

		(L.L.nuntius_printer_scriptTextureCurrentIndex) 748 l0 - 128 (L.L.nuntius_printer_font_38pxRegular) 1 0 (L.$.nuntius_printer_ui_ticketPrice0) (M.V.STTextOut)
		(L.L.nuntius_printer_scriptTextureCurrentIndex) 990 l1 - 128 (L.L.nuntius_printer_font_38pxRegular) 1 0 (L.$.nuntius_printer_ui_ticketPrice1) (M.V.STTextOut)
		(L.L.nuntius_printer_scriptTextureCurrentIndex) 748 l2 - 234 (L.L.nuntius_printer_font_38pxRegular) 1 0 (L.$.nuntius_printer_ui_ticketPrice2) (M.V.STTextOut)
		(L.L.nuntius_printer_scriptTextureCurrentIndex) 990 l3 - 234 (L.L.nuntius_printer_font_38pxRegular) 1 0 (L.$.nuntius_printer_ui_ticketPrice3) (M.V.STTextOut)
		(L.L.nuntius_printer_scriptTextureCurrentIndex) 748 l4 - 340 (L.L.nuntius_printer_font_38pxRegular) 1 0 (L.$.nuntius_printer_ui_ticketPrice4) (M.V.STTextOut)
		(L.L.nuntius_printer_scriptTextureCurrentIndex) 990 l5 - 340 (L.L.nuntius_printer_font_38pxRegular) 1 0 (L.$.nuntius_printer_ui_ticketPrice5) (M.V.STTextOut)
		(L.L.nuntius_printer_scriptTextureCurrentIndex) 748 l6 - 446 (L.L.nuntius_printer_font_38pxRegular) 1 0 (L.$.nuntius_printer_ui_ticketPrice6) (M.V.STTextOut)
		(L.L.nuntius_printer_scriptTextureCurrentIndex) 990 l7 - 446 (L.L.nuntius_printer_font_38pxRegular) 1 0 (L.$.nuntius_printer_ui_ticketPrice7) (M.V.STTextOut)
	{endif}

'******************************************
' Current Ticket
'******************************************
	(L.L.nuntius_printer_visTicketSelection)
	{if}
		(L.L.nuntius_printer_scriptTextureCurrentIndex) 539 133 (L.L.nuntius_printer_font_72pxRegular) 1 0 (L.$.nuntius_printer_ui_currentTicketName)  (M.V.STTextOut)
		(L.L.nuntius_printer_scriptTextureCurrentIndex) 539 288 (L.L.nuntius_printer_font_72pxRegular) 1 0 (L.$.nuntius_printer_ui_currentTicketPrice) (M.V.STTextOut)
	{endif}

'******************************************
' Busstop list
'******************************************
	(L.L.nuntius_printer_visBusstopList)
	{if}
		(L.L.nuntius_printer_scriptTextureCurrentIndex)  64 435 (L.L.nuntius_printer_font_38pxMedium)  1 0 (L.$.nuntius_printer_ui_busstop0)        (M.V.STTextOut)
		(L.L.nuntius_printer_scriptTextureCurrentIndex)  64 372 (L.L.nuntius_printer_font_38pxRegular) 1 0 (L.$.nuntius_printer_ui_busstop1)        (M.V.STTextOut)
		(L.L.nuntius_printer_scriptTextureCurrentIndex)  64 316 (L.L.nuntius_printer_font_38pxRegular) 1 0 (L.$.nuntius_printer_ui_busstop2)        (M.V.STTextOut)
		(L.L.nuntius_printer_scriptTextureCurrentIndex)  64 260 (L.L.nuntius_printer_font_38pxRegular) 1 0 (L.$.nuntius_printer_ui_busstop3)        (M.V.STTextOut)
		(L.L.nuntius_printer_scriptTextureCurrentIndex)  64 204 (L.L.nuntius_printer_font_38pxRegular) 1 0 (L.$.nuntius_printer_ui_busstop4)        (M.V.STTextOut)
		(L.L.nuntius_printer_scriptTextureCurrentIndex)  64 117 (L.L.nuntius_printer_font_38pxMedium)  1 0 (L.$.nuntius_printer_ui_busstop_end)     (M.V.STTextOut)

		(L.$.nuntius_printer_ui_busstopTime0)    (L.L.nuntius_printer_font_38pxMedium)  (M.V.TextLength) s0
		(L.$.nuntius_printer_ui_busstopTime1)    (L.L.nuntius_printer_font_38pxRegular) (M.V.TextLength) s1
		(L.$.nuntius_printer_ui_busstopTime2)    (L.L.nuntius_printer_font_38pxRegular) (M.V.TextLength) s2
		(L.$.nuntius_printer_ui_busstopTime3)    (L.L.nuntius_printer_font_38pxRegular) (M.V.TextLength) s3
		(L.$.nuntius_printer_ui_busstopTime4)    (L.L.nuntius_printer_font_38pxRegular) (M.V.TextLength) s4
		(L.$.nuntius_printer_ui_busstopTime_end) (L.L.nuntius_printer_font_38pxMedium)  (M.V.TextLength) s5
   
		(L.L.nuntius_printer_scriptTextureCurrentIndex) 408 l0 - 435 (L.L.nuntius_printer_font_38pxMedium)  1 0 (L.$.nuntius_printer_ui_busstopTime0)    (M.V.STTextOut)
		(L.L.nuntius_printer_scriptTextureCurrentIndex) 408 l1 - 372 (L.L.nuntius_printer_font_38pxRegular) 1 0 (L.$.nuntius_printer_ui_busstopTime1)    (M.V.STTextOut)
		(L.L.nuntius_printer_scriptTextureCurrentIndex) 408 l2 - 316 (L.L.nuntius_printer_font_38pxRegular) 1 0 (L.$.nuntius_printer_ui_busstopTime2)    (M.V.STTextOut)
		(L.L.nuntius_printer_scriptTextureCurrentIndex) 408 l3 - 260 (L.L.nuntius_printer_font_38pxRegular) 1 0 (L.$.nuntius_printer_ui_busstopTime3)    (M.V.STTextOut)
		(L.L.nuntius_printer_scriptTextureCurrentIndex) 408 l4 - 204 (L.L.nuntius_printer_font_38pxRegular) 1 0 (L.$.nuntius_printer_ui_busstopTime4)    (M.V.STTextOut)
		(L.L.nuntius_printer_scriptTextureCurrentIndex) 408 l5 - 117 (L.L.nuntius_printer_font_38pxMedium)  1 0 (L.$.nuntius_printer_ui_busstopTime_end) (M.V.STTextOut)
	{endif} 

'******************************************
' Next Trip
'******************************************
	(L.L.nuntius_printer_visConfirmNextTrip)
	{if}
		(L.L.nuntius_printer_scriptTextureCurrentIndex) 632 301 (L.L.nuntius_printer_font_28pxRegular) 1 0 (L.$.nuntius_printer_ui_confirmNextTripText1) (M.V.STTextOut)
		(L.L.nuntius_printer_scriptTextureCurrentIndex) 632 330 (L.L.nuntius_printer_font_28pxRegular) 1 0 (L.$.nuntius_printer_ui_confirmNextTripText2) (M.V.STTextOut)
		(L.L.nuntius_printer_scriptTextureCurrentIndex) 632 359 (L.L.nuntius_printer_font_28pxRegular) 1 0 (L.$.nuntius_printer_ui_confirmNextTripText3) (M.V.STTextOut)
		(L.L.nuntius_printer_scriptTextureCurrentIndex) 632 388 (L.L.nuntius_printer_font_28pxRegular) 1 0 (L.$.nuntius_printer_ui_confirmNextTripText4) (M.V.STTextOut)
		(L.L.nuntius_printer_scriptTextureCurrentIndex) 632 417 (L.L.nuntius_printer_font_28pxRegular) 1 0 (L.$.nuntius_printer_ui_confirmNextTripText5) (M.V.STTextOut)
	{endif}

'******************************************
' Screen Brightness
'******************************************

(L.L.nuntius_printer_visMenuAppearance)
	{if}
		(L.L.nuntius_printer_displayBrightnessPercent) $IntToStr "%" $+ (S.$.nuntius_printer_tmpStr0)
		(L.L.nuntius_printer_scriptTextureCurrentIndex) 596 304 (L.L.nuntius_printer_font_38pxRegular) 1 0 (L.$.nuntius_printer_tmpStr0) (M.V.STTextOut)
	{endif}

	(L.L.nuntius_printer_scriptTextureCurrentIndex) (M.V.STUnlock)
	(L.L.nuntius_printer_scriptTextureCurrentIndex) (M.V.STFilter)

' Lock, unlock and filter again (works better sometimes for some reason...)
	(L.L.nuntius_printer_scriptTextureCurrentIndex) (M.V.STLock)
	(L.L.nuntius_printer_scriptTextureCurrentIndex) (M.V.STUnlock)
	(L.L.nuntius_printer_scriptTextureCurrentIndex) (M.V.STFilter)
{end}

{macro:nuntius_printer_renderScriptTextureFrame}
'******************************************
' Date/Time
'******************************************
	(L.L.nuntius_printer_visTime)
	{if}
' Get String
		(M.L.nuntius_printer_getDateString) (S.$.nuntius_printer_tmpStr0)
' Calc length
		(L.L.nuntius_printer_font_38pxRegular) (M.V.TextLength) s1
' Write Command
		(L.L.nuntius_printer_scriptTextureCurrentIndex)
		1020 l1 -
		0
		(L.L.nuntius_printer_font_38pxRegular)
		1
		0
		(L.$.nuntius_printer_tmpStr0)
		(M.V.STTextOut)

' Get String
		(M.L.nuntius_printer_getTimeString) (S.$.nuntius_printer_tmpStr0)
' Calc length
		(L.L.nuntius_printer_font_38pxRegular) (M.V.TextLength) s1
' Write Command
		(L.L.nuntius_printer_scriptTextureCurrentIndex)
		1020 l1 -
		38
		(L.L.nuntius_printer_font_38pxRegular)
		1
		0
		(L.$.nuntius_printer_tmpStr0)
		(M.V.STTextOut)
	{endif}

'******************************************
' Delay
'******************************************
	(L.L.nuntius_printer_visDelay)
	{if}
' Calc Length
		(L.$.nuntius_printer_ui_delay) (L.L.nuntius_printer_font_48pxMedium) (M.V.TextLength) s1
' Write                                           XLeft + ((fieldWidth - length) / 2) -> but not below 770 :)
		(L.L.nuntius_printer_scriptTextureCurrentIndex) 770 113 l1 - 2 / + 770 max 19 (L.L.nuntius_printer_font_48pxMedium) 1 0 (L.$.nuntius_printer_ui_delay) (M.V.STTextOut)
	{endif}

'******************************************
' Entfernung zur nächsten Haltestelle
'******************************************
	(L.L.nuntius_printer_distance_nextBusstopDistance) s1

	(L.L.nuntius_printer_visBusstopDistance)
	(L.L.schedule_active) &&
	(L.L.nuntius_printer_RouteMode) 0 = ! &&
	{if}

' Don't show anything if there is no valid value or the last was smaller than now (means it's too inaccurate at the time or the GPS is "confused")
		l1 trunc 0 <=
		l1 1 - (L.L.nuntius_printer_distance_nextBusstopDistanceLast) >= ||
		{if}
			"-- m"
		{else}
			l1 1000 >=
			{if}
' Convert to km with one num after the point for large distances
				l1 1000 / trunc $IntToStr "," $+ l1 100 / trunc 10 % $IntToStr $+
				" km" $+ 
			{else}
				l1 trunc $IntToStr
				" m" $+ 
			{endif}
		{endif}
		(S.$.nuntius_printer_tmpStr0)
		
		(L.L.nuntius_printer_scriptTextureCurrentIndex) 146 498 (L.L.nuntius_printer_font_38pxRegular)  1 0 "Haltestelle in:" (M.V.STTextOut)
		(L.L.nuntius_printer_scriptTextureCurrentIndex) 146 532 (L.L.nuntius_printer_font_38pxRegular)  1 0 (L.$.nuntius_printer_tmpStr0) (M.V.STTextOut)
	{endif}
{end}

'################################
'general functions and power
'################################

'handles the boot (will be executed every frame)
{macro:nuntius_printer_bootHandler}
'Boot Status:
'0 = Off (no electric)
'1 = booting
'2 = booted (running)
'3 = battery mode
'4 = sleep mode

'if bus electric is on, boot device/hold it on, else shut it down
	(L.L.nuntius_input_power)
	{if}
'if it's booting currently, continue
		(L.L.nuntius_printer_bootStatus) 1 <=
		{if}
			(M.L.nuntius_printer_boot)
		{endif}
'if the electric is on (s.o.), but the boot status is still 4, turn the screen back on
		(L.L.nuntius_printer_bootStatus) 4 =
		{if}
			(M.L.nuntius_printer_turnScreenOn)
		{endif}
'else if electric is not on...
	{else}
'...and the printer is active (!=0), turn energysaver on
		(L.L.nuntius_printer_bootStatus)
		{if}
			(M.L.nuntius_printer_runEnergySaver)
		{endif}
	{endif}
{end}

'Executes the printers boot
{macro:nuntius_printer_boot}

	(L.L.nuntius_printer_bootStatus) 0 =
	{if}
		1 (S.L.nuntius_printer_screenIsOn)
		1 (S.L.nuntius_printer_bootStatus)
		0 (S.L.nuntius_printer_bootTimer)
		(M.L.nuntius_printer_hideAllUiElements)
		(L.$.nuntius_printer_currentDisplayTextureFolder) "Boot_1.dds" $+ (S.$.nuntius_printer_ui_texture)

		-1 (S.L.nuntius_printer_selectedTicket)

		1 (S.L.nuntius_printer_screenSoundIsActive)
		(S.L.nuntius_printer_AnnouncementsAreActive)
		(M.L.nuntius_printer_loadOptions)
		(M.L.nuntius_printer_loadTickets)
	{endif}
					
'increase timer
	(L.L.nuntius_printer_bootTimer) (L.S.Timegap) + (S.L.nuntius_printer_bootTimer)

	(L.$.nuntius_printer_currentDisplayTextureFolder) "Boot_" $+
	(L.L.nuntius_printer_bootTimer) (C.L.nuntius_printer_bootSpeed) * (F.L.boot) $IntToStr $+
	".dds" $+
	(S.$.nuntius_printer_ui_texture)

	(L.L.nuntius_printer_bootTimer) (C.L.nuntius_printer_bootSpeed) * 30 >=
	{if}
		2 (S.L.nuntius_printer_bootStatus)
		0 (S.L.nuntius_printer_bootTimer)
		0 (M.L.nuntius_printer_goToPage)
	{endif}
{end}

'manages the energy saver mode
{macro:nuntius_printer_runEnergySaver}
'if printer is running
	(L.L.nuntius_printer_bootStatus) 2 = 
	{if}
'set energy saving mode and setup printer
		3 (S.L.nuntius_printer_bootStatus)
		0 (S.L.nuntius_printer_batteryTimer)
	{else}
'else if is already off (0) or currently on boot (1), directly turn it of
		(L.L.nuntius_printer_bootStatus) 1 <= 
		{if}
			(M.L.nuntius_printer_shutDown)
		{else}
'else manage energy saving
'increase timer
			(L.L.nuntius_printer_batteryTimer) (L.S.Timegap) + (S.L.nuntius_printer_batteryTimer)
'if battery timer is smaller than maximum
			(L.L.nuntius_printer_batteryTimer) (C.L.nuntius_printer_batteryTime) <
			{if}
'if it's bigger than screen time, turn screen of
				(L.L.nuntius_printer_batteryTimer) (C.L.nuntius_printer_batteryTimeActiveScreen) >
				{if}
					(M.L.nuntius_printer_turnScreenOff)
				{endif}
			{else}
'if timer is bigger, shut down
				(M.L.nuntius_printer_shutDown)
			{endif}
		{endif}
	{endif}
{end}

'shuts down the printer
{macro:nuntius_printer_shutDown}
	(M.L.nuntius_printer_turnScreenOff)
	0
	(S.L.nuntius_printer_bootStatus)
	(S.L.nuntius_printer_AutoHFSDisabled)
	(S.L.nuntius_printer_RouteMode)
	(S.L.nuntius_printer_Line)
	(S.L.nuntius_printer_Route)
	(S.L.nuntius_printer_RouteIndex)
	(S.L.nuntius_printer_Suffix)
	(S.L.nuntius_printer_Terminus)
	(S.L.nuntius_printer_TerminusIndex)
	(S.L.nuntius_printer_specialTerminus)
	(S.L.nuntius_printer_currentBusstopIndex)
	(S.L.nuntius_printer_busstopOffset)
	(S.L.nuntius_printer_selectedTicket)
	(S.L.nuntius_printer_givenTicket)
	(S.L.nuntius_printer_showDeparturePage)
	(S.L.nuntius_printer_AnnouncementsAreActive)

	(S.L.nuntius_output_pauseActive)
	(S.L.nuntius_output_lineNumber)
	(S.L.nuntius_output_lineSuffix)
	(S.L.nuntius_output_busstopIndex0)
	(S.L.nuntius_output_busstopIndex1)
	(S.L.nuntius_output_busstopIndex2)
	(S.L.nuntius_output_busstopIndex3)
	(S.L.nuntius_output_busstopIndex4)
	(S.L.nuntius_output_busstopIndex5)
	(S.L.nuntius_output_busstopIndex6)
	(S.L.nuntius_output_busstopIndex7)

	""
	(S.$.nuntius_output_lineString)
	(S.$.nuntius_output_terminusString)
	(S.$.nuntius_output_busstopString0)
	(S.$.nuntius_output_busstopString1)
	(S.$.nuntius_output_busstopString2)
	(S.$.nuntius_output_busstopString3)
	(S.$.nuntius_output_busstopString4)
	(S.$.nuntius_output_busstopString5)
	(S.$.nuntius_output_busstopString6)
	(S.$.nuntius_output_busstopString7)
	(S.$.nuntius_output_busstopString0first)
	(S.$.nuntius_output_busstopString1first)
	(S.$.nuntius_output_busstopString2first)
	(S.$.nuntius_output_busstopString3first)
	(S.$.nuntius_output_busstopString4first)
	(S.$.nuntius_output_busstopString5first)
	(S.$.nuntius_output_busstopString6first)
	(S.$.nuntius_output_busstopString7first)
	(S.$.nuntius_output_busstopString0second)
	(S.$.nuntius_output_busstopString1second)
	(S.$.nuntius_output_busstopString2second)
	(S.$.nuntius_output_busstopString3second)
	(S.$.nuntius_output_busstopString4second)
	(S.$.nuntius_output_busstopString5second)
	(S.$.nuntius_output_busstopString6second)
	(S.$.nuntius_output_busstopString7second)

	100 (S.L.nuntius_printer_displayBrightnessPercent)
	0 (S.L.nuntius_printer_displayBrightnessFloat)
{end}

'turns the printers screen off
{macro:nuntius_printer_turnScreenOff}
	4 (S.L.nuntius_printer_bootStatus)
	0 (S.L.nuntius_printer_screenIsOn)
	(L.$.nuntius_printer_currentDisplayTextureFolder) "Black.dds" $+ (S.$.nuntius_printer_ui_texture)
	(M.L.nuntius_printer_hideAllUiElements)
{end}

'turns the printers screen on
{macro:nuntius_printer_turnScreenOn}
	2 (S.L.nuntius_printer_bootStatus)
	1 (S.L.nuntius_printer_screenIsOn)
	(L.L.nuntius_printer_page) (M.L.nuntius_printer_goToPage)
{end}


'################################
'Handler
'################################

'Loads the options from the hof file
{macro:nuntius_printer_loadOptions}
'Register:
'0 = the option terminus' index
	
	1234 (M.V.GetTerminusIndex) s0

	l0 0 (M.V.GetTerminusString) $RemoveSpaces "NUNTIUS_OPTIONS" $=
	(S.L.nuntius_printer_hasHofFileOptions)
	{if}
		l0 1 (M.V.GetTerminusString) $StrToFloat (S.L.nuntius_printer_option_terminusCodeTripEnd)
		l0 2 (M.V.GetTerminusString) $StrToFloat (S.L.nuntius_printer_option_terminusCodeBreak)
	{endif}
{end}

{macro:nuntius_printer_updateColorScheme}
	(L.L.nuntius_printer_colorScheme) s0

	(L.L.nuntius_printer_colorSchemeSetting) 0 =
	{if}
		(L.S.SunAlt) 2.5 < 1 + 
	{else}
		(L.L.nuntius_printer_colorSchemeSetting)
	{endif}
	(S.L.nuntius_printer_colorScheme)

	1 -
	{if}   "nuntius\ui_default_dark\"
	{else} "nuntius\ui_default_light\"
	{endif}
	(S.$.nuntius_printer_currentDisplayTextureFolder)

	l0 (L.L.nuntius_printer_colorScheme) = !
	{if}
		(L.L.nuntius_printer_page) (M.L.nuntius_printer_goToPage)
	{endif}
{end}

{macro:nuntius_printer_autoOpenBusstopPage}
'if any of all the entrys or exits is open...
	(L.L.nuntius_input_doorsOpen)
	{if}
'and:
'the current printer page is 2 (home)
'the velocity is nearly zero
'the autoBusstopPageSwitch is 0 (which means the user hasn't switched the page manually)
		(L.L.nuntius_printer_page) 2 =
		(L.L.Velocity) abs 10 < &&
		(L.L.nuntius_printer_autoBusstopPageSwitch) 0 = &&
		{if}
'go to page and set the autoBusstopPageSwitch to 1
			3 (M.L.nuntius_printer_goToPage)
			1 (S.L.nuntius_printer_autoBusstopPageSwitch)
		{endif}
	{else}
'else if:
'the current printer page is 3 (busstop menu)
'the vehicle is moving (velocity more than 5 km/h)
'the autoBusstopPageSwitch is 1 (which means the user hasn't switched the page manually)
		(L.L.nuntius_printer_page) 3 = (L.L.nuntius_printer_page) 11 = ||
		(L.L.Velocity) abs 10 > &&
		(L.L.nuntius_printer_autoBusstopPageSwitch) 1 = &&
		{if}
'go to page and set the autoBusstopPageSwitch to 0
			2 (M.L.nuntius_printer_goToPage)
			0 (S.L.nuntius_printer_autoBusstopPageSwitch)
		{endif}
	{endif}
{end}

{macro:nuntius_printer_autoOpenDeparturePage}

'only do something if schedule is active
	(L.L.schedule_active)
	{if}
'if the delay is more than negative 60 (= one minute early)
		(M.V.GetTTDelay) -60 <
		{if}
'remember to show page
			1 (S.L.nuntius_printer_showDeparturePage)
		{endif}
'if delay turns 0 and showDeparturePage is remembered
		(M.V.GetTTDelay) 0 >= (L.L.nuntius_printer_showDeparturePage) 1 = &&
		{if}
			(L.L.velocity) abs 10 <
			(L.L.nuntius_printer_page) 2 =
			(L.L.nuntius_printer_page) 3 = || &&
			{if}
'show page
				11 (M.L.nuntius_printer_goToPage)
				(M.L.nuntius_printer_playSoundNormal)
			{endif}
			0 (S.L.nuntius_printer_showDeparturePage)
		{endif}
	{else}
		0 (S.L.nuntius_printer_showDeparturePage)
	{endif}
{end}

'Automatically opens the confirm-next-Trip-page if needed
{macro:nuntius_printer_autoOpenConfirmNextTripPage}
'if we are currently in schedule mode
	(L.L.schedule_active) (L.L.nuntius_printer_RouteMode) 1 = && (L.L.nuntius_printer_page) 12 = ! &&
'if the expected and actual terminus are not the same or we jumped more than 1 busstop back (which is not possible in the same tour)
	{if}
		(M.V.GetTTBusstopIndex) (L.L.nuntius_printer_currentBusstopIndex) 1 - <
		{if}
			(M.V.GetTTLineString) (S.$.nuntius_printer_ui_confirmNextTripText1)

			(M.V.GetTTTerminusIndex) 5 (M.V.GetTerminusString) (S.$.nuntius_printer_ui_confirmNextTripText2)


			0 (M.V.GetTTBusstopDep) (L.S.Time) - 60 / trunc 1440 % s2
			0 >= {if}
				"in "
			{else}
				"vor "
			{endif}
			l2 abs $IntToStr $+
			" Min." $+ (S.$.nuntius_printer_ui_confirmNextTripText3)


			0 s0
			(M.V.GetTTBusstopDep) s1

			l0 (M.V.GetTTBusstopName)
			
			" (" $+
			l1 3600 / trunc 24 % "02" $IntToStrEnh $+
			":" $+
			l1 3600 % 60 / trunc "02" $IntToStrEnh $+
			")" $+ (S.$.nuntius_printer_ui_confirmNextTripText4)

			(M.V.GetTTBusstopCount) 1 - s0
			(M.V.GetTTBusstopArr) s1

			l0 (M.V.GetTTBusstopName)

			" (" $+
			l1 3600 / trunc 24 % "02" $IntToStrEnh $+
			":" $+
			l1 3600 % 60 / trunc "02" $IntToStrEnh $+
			")" $+ (S.$.nuntius_printer_ui_confirmNextTripText5)

'show page
			12 (M.L.nuntius_printer_goToPage)
		{endif}
	{endif}
{end}

'automatically sets the terminus to "Fahrtende" at last busstop of trip
{macro:nuntius_printer_autoSetTripEndTerminus}
'Register:
'0 = last busstop?
	(L.L.nuntius_printer_Terminus) (L.L.nuntius_printer_option_terminusCodeTripEnd) = !
	(L.L.nuntius_printer_page) 7 = !
	(L.L.nuntius_printer_page) 71 = ! || &&
	(L.L.nuntius_printer_hasHofFileOptions) &&
	(M.V.GetTTBusstopCount) 1 > &&
	(L.L.schedule_active) &&
	{if}
		(L.L.nuntius_printer_RouteMode) 1 =
		{if}
			(M.V.GetTTBusstopCount) (L.L.nuntius_printer_currentBusstopIndex) (L.L.nuntius_printer_busstopOffset) + 1 + = s0
		{endif}

		(L.L.nuntius_printer_RouteMode) 2 =
		{if}
			(L.L.nuntius_printer_RouteIndex) (M.V.GetBusstopCount) (L.L.nuntius_printer_currentBusstopIndex) (L.L.nuntius_printer_busstopOffset) + 1 +  = s0
		{endif}

		l0
		(L.L.nuntius_printer_RouteMode) 1 =
		(L.L.nuntius_printer_RouteMode) 2 = || &&
		{if}
			(L.L.nuntius_printer_option_terminusCodeTripEnd) (M.L.nuntius_printer_setTerminus)
			(M.L.nuntius_printer_refreshLineUI)
		{endif}
	{endif}
{end}


'################################
'General OS
'################################

{macro:nuntius_printer_getDateString}
'Register Values:
'0 = year
'1 = month
'2 = day (nur die letzten zwei Ziffern)
	(L.S.Year) 100 % s0
	(L.S.Day) s2
	(L.S.Month) s1
	l2 "02" $IntToStrEnh "." $+
	l1 "02" $IntToStrEnh $+ "." $+
	l0 "02" $IntToStrEnh $+
{end}

{macro:nuntius_printer_getTimeString}
'Register Values:
'1 = hour
'2 = minute
'3 = second
	(L.S.Time) 3600 / trunc s1
	(L.S.Time) 3600 % 60 / trunc s2
	(L.S.Time) 60 % s3

	l1 "02" $IntToStrEnh ":" $+
	l2 "02" $IntToStrEnh $+ ":" $+
	l3 "02" $IntToStrEnh $+
{end}

'Refreshs delay box
{macro:nuntius_printer_refreshDelay}
'Register Values:
'0 = delay in seconds
'1 = full minutes
'2 = rest seconds (rounded to 10th)
'3 = sign (+/0/-)

'only, if shedule is active
	(L.L.schedule_active)
	{if}
'get full minutes (absolute value of delay seconds divided by 60)
		(M.V.GetTTDelay) s0 60 / abs s1
'get the sign
		(C.L.nuntius_printer_invertDelaySign)
		{if} l0 /-/
		{else} l0
		{endif}
		sgn s3

'get rest seconds (rounded to 10th):
'get rest seconds (all seconds "%" by 60, divide 10, trunc and multiply with 10 again and get absolute (positive) value)
		l0 60 % 10 / trunc 10 * abs s2

'Print String
'decide for the correct sign
		l3 0 <
		{if}
			"-"
		{else}
			l3 0 >
			{if}
				"+"
			{else}
				""
			{endif}
		{endif}
'add minutes to string
		l1 $IntToStr $+
		
'only add seconds if the minutes are only one character long
		l1 10 < l1 -10 > &&
		{if}
			":" $+ l2 "02" $IntToStrEnh $+	
		{endif}
		(S.$.nuntius_printer_ui_delay)
		
'choose the correct background color
		l0 -60 <=
		{if}
			"nuntius\red.dds" (S.$.nuntius_printer_ui_delayColor)
		{endif}
		
		l0 -60 > l0 300 < &&
		{if}
			"nuntius\green.dds" (S.$.nuntius_printer_ui_delayColor)
		{endif}
		
		l0 300 >=
		{if}
			"nuntius\orange.dds" (S.$.nuntius_printer_ui_delayColor)
		{endif}

	{else}
'else print "--:--" placeholder and set color to blue
		"--:--" (S.$.nuntius_printer_ui_delay)
		"nuntius\blue.dds" (S.$.nuntius_printer_ui_delayColor)
	{endif}
{end}

'executes a specified numpad button
'Arguments:
'0 = pressed button (0-9 normal, 10 = C)
{macro:nuntius_printer_numpadButton}
'Register:
'0 = pressed button (0-9 normal, 10 = Backspace/C)
'1 = field index (0-2)
'2 = is it active in general? (if selected field is not visible, do nothing)

'save the pressed button (0-9 normal, 10 = Backspace/C)
s0

'Schedule Scripttex for update
(M.L.nuntius_printer_scheduleScriptTextForUpdate)

'if fields are not enabled, do nothing in general!

	(L.L.nuntius_printer_inputFieldsEnabled)
	{if}
'init state
		0 s2

'play sound
		(M.L.nuntius_printer_playSoundNormal)

'save field index
		(L.L.nuntius_printer_currentInputField) s1

'check if field is enabled and load data
		l1 0 = (L.L.nuntius_printer_visInput0) 1 = &&
		{if}
			(L.$.nuntius_printer_ui_input0)
			1 s2
		{endif}

		l1 1 = (L.L.nuntius_printer_visInput1) 1 = &&
		{if}
			(L.$.nuntius_printer_ui_input1)
			1 s2
		{endif}

		l1 2 = (L.L.nuntius_printer_visInput2) 1 = &&
		{if}
			(L.$.nuntius_printer_ui_input2)
			1 s2
		{endif}

'if field is enabled
		l2
		{if}
'add character to string
			l0 9 <=
			{if}
				l0 $IntToStr $+
			{endif}
			
'or delete one...
			l0 10 =
			{if}
				1 $cutEnd 
			{endif}

'write "0" if field would be empty
			$length 0 =
			{if}
				"0"
			{endif}

'Convert to number and back to string (to remove leading zeros) - THIS CAUSES ERRORS ON LARGE NUMBERS!!!! :(((
			$StrToFloat $IntToStr

'save it to the current input field
			l1 0 =
			{if}
				(S.$.nuntius_printer_ui_input0)
			{endif}
			
			l1 1 =
			{if}
				(S.$.nuntius_printer_ui_input1)
			{endif}
			
			l1 2 =
			{if}
				(S.$.nuntius_printer_ui_input2)
			{endif}
		{endif}
	{endif}
{end}

'executes the numpads enter command
{macro:nuntius_printer_numpadEnter}
'if the next input field's index is still smaller than the count...
	(L.L.nuntius_printer_currentInputField) 1 + (L.L.nuntius_printer_InputFieldCount) <
	{if}
'jump to next input field
		(L.L.nuntius_printer_currentInputField) 1 + (M.L.nuntius_printer_focusInputField)
'play sound
		(M.L.nuntius_printer_playSoundNormal)
	{else}
'else run apply command
		(M.L.nuntius_printer_apply)
	{endif}
{end}

'executes the apply command
{macro:nuntius_printer_apply}

'Login page
	(L.L.nuntius_printer_page) 1 =
	{if}
		1 1 (M.L.nuntius_printer_startWaitTime)
	{endif}

'Login from break page
	(L.L.nuntius_printer_page) 71 =
	{if}
		2 1 (M.L.nuntius_printer_startWaitTime)
	{endif}

'LKR page
	(L.L.nuntius_printer_page) 4 =
	{if}
		(M.L.nuntius_printer_loadHofTrip)
	{endif}

'Terminus page
	(L.L.nuntius_printer_page) 5 =
	{if}
		(M.L.nuntius_printer_specialTerminus)
	{endif}

'Driver switch page
	(L.L.nuntius_printer_page) 9 =
	{if}
		(M.L.nuntius_printer_driverSwitch)
	{endif}

'Shift end page
	(L.L.nuntius_printer_page) 10 =
	{if}
		(M.L.nuntius_printer_shiftEnd)
	{endif}

'Departure page
	(L.L.nuntius_printer_page) 11 =
	{if}
		2 (M.L.nuntius_printer_goToPage)
		0 (S.L.nuntius_printer_autoBusstopPageSwitch)
	{endif}

'confirm next trip page
	(L.L.nuntius_printer_page) 12 =
	{if}
		(M.L.nuntius_printer_loadTTTrip)
	{endif}

'confirm bad input
	(L.L.nuntius_printer_page) 98 =
	{if}
		(L.L.nuntius_printer_targetPage) (M.L.nuntius_printer_goToPage)
	{endif}
{end}

'executes the reset command
{macro:nuntius_printer_reset}
'LKR page
	(L.L.nuntius_printer_page) 4 =
	{if}
		(M.L.nuntius_printer_removeTrip)
	{endif}

'Terminus page
	(L.L.nuntius_printer_page) 5 =
	{if}
		(M.L.nuntius_printer_resetTerminus)
	{endif}

'confirm next trip page
	(L.L.nuntius_printer_page) 12 =
	{if}
		(M.L.nuntius_printer_denyNextTrip)
	{endif}

'play sound
	(M.L.nuntius_printer_playSoundNormal)
{end}

'executes the auto command
{macro:nuntius_printer_auto}
'LKR page
	(L.L.nuntius_printer_page) 4 =
	{if}
		(M.L.nuntius_printer_loadTTTrip)
	{endif}

'confirm next trip page
	(L.L.nuntius_printer_page) 12 =
	{if}
		(M.L.nuntius_printer_acceptNextTripWithBreak)
	{endif}

'play sound
	(M.L.nuntius_printer_playSoundNormal)
{end}

'executes the back command
{macro:nuntius_printer_back}
'Login page
	(L.L.nuntius_printer_page) 1 =
	{if}
		(M.L.nuntius_printer_resetInputFields)
		0 (M.L.nuntius_printer_goToPage)
	{endif}

'busstop page
	(L.L.nuntius_printer_page) 3 =
	{if}
		(M.L.nuntius_printer_resetInputFields)
		2 (M.L.nuntius_printer_goToPage)
	{endif}

'LRK page
	(L.L.nuntius_printer_page) 4 =
	{if}
		(M.L.nuntius_printer_resetInputFields)
		2 (M.L.nuntius_printer_goToPage)
	{endif}

'Terminus page
	(L.L.nuntius_printer_page) 5 =
	{if}
		(M.L.nuntius_printer_resetInputFields)
		2 (M.L.nuntius_printer_goToPage)
	{endif}

'Announcements page
	(L.L.nuntius_printer_page) 6 =
	{if}
		2 (M.L.nuntius_printer_goToPage)
	{endif}

'Driver switch page
	(L.L.nuntius_printer_page) 9 =
	{if}
		(M.L.nuntius_printer_resetInputFields)
		2 (M.L.nuntius_printer_goToPage)
	{endif}

'Shift End page
	(L.L.nuntius_printer_page) 10 =
	{if}
		(M.L.nuntius_printer_resetInputFields)
		2 (M.L.nuntius_printer_goToPage)
	{endif}

'Departure page
	(L.L.nuntius_printer_page) 11 =
	{if}
		2 (M.L.nuntius_printer_goToPage)
	{endif}

'Menu page
	(L.L.nuntius_printer_page) 20 =
	{if}
		2 (M.L.nuntius_printer_goToPage)
	{endif}

'play sound
	(M.L.nuntius_printer_playSoundNormal)
{end}

'changes, which input field should be focused
'Arguments:
'0 = target input field (0-2)
{macro:nuntius_printer_focusInputField}
	s0
'Register
'0 = target field index

	1 + (L.L.nuntius_printer_InputFieldCount) <=
	{if}

'login page
		(L.L.nuntius_printer_page) 1 = 
		{if}
			l0 (S.L.nuntius_printer_currentInputField)
			
			l0 0 =
			{if}
				(L.$.nuntius_printer_currentDisplayTextureFolder) "Login_withID_ID.dds" $+ (S.$.nuntius_printer_ui_texture)
			{endif}
			
			l0 1 =
			{if}
				(L.$.nuntius_printer_currentDisplayTextureFolder) "Login_withID_PIN.dds" $+ (S.$.nuntius_printer_ui_texture)
			{endif}
		{endif}
		
'LKR page
		(L.L.nuntius_printer_page) 4 = 
		{if}
			l0 (S.L.nuntius_printer_currentInputField)
			
			l0 0 =
			{if}
				(L.$.nuntius_printer_currentDisplayTextureFolder) "LKR_man_Line.dds" $+ (S.$.nuntius_printer_ui_texture)
			{endif}
			
			l0 1 =
			{if}
				(L.$.nuntius_printer_currentDisplayTextureFolder) "LKR_man_Route.dds" $+ (S.$.nuntius_printer_ui_texture)
			{endif}
			
			l0 2 =
			{if}
				(L.$.nuntius_printer_currentDisplayTextureFolder) "LKR_man_Terminus.dds" $+ (S.$.nuntius_printer_ui_texture)
			{endif}
		{endif}

'play sound
		(M.L.nuntius_printer_playSoundNormal)
	{endif}
{end}

'checks if the login is valid
{macro:nuntius_printer_checkLogin}
'compare values
	(L.$.nuntius_printer_ui_input0) $StrToFloat (C.L.nuntius_printer_driverID) = s0
	(L.$.nuntius_printer_ui_input1) $StrToFloat (C.L.nuntius_printer_driverPIN) = s1

'if both is correct...
	l0 l1 &&
	{if}
'go to home page
		(M.L.nuntius_printer_resetInputFields)

		"Testdruck wird durchgeführt..." (S.$.nuntius_printer_ui_loadingInfo) (M.L.nuntius_printer_scheduleScriptTextForUpdate)
		2 1 (M.L.nuntius_printer_goToPageAfterWaitTime)
'print test
		1 (S.L.nuntius_ticketPrinting)
'play sound
		(M.L.nuntius_printer_playSoundNormal)
	{else}
'play sound
		(M.L.nuntius_printer_playSoundError)
		"Eingabe fehlerhaft!" (S.$.nuntius_printer_ui_loadingInfo)
		98 (M.L.nuntius_printer_goToPage)
		1 (S.L.nuntius_printer_targetPage)
	{endif}
{end}


{macro:nuntius_printer_checkLoginAfterBreak}
	(L.$.nuntius_printer_ui_input0) $StrToFloat (C.L.nuntius_printer_driverPIN) =
	{if}
'go to home page
		(M.L.nuntius_printer_resetInputFields)

		2 (M.L.nuntius_printer_goToPage)
		
		(L.L.nuntius_printer_hasHofFileOptions)
		{if}
			(L.L.nuntius_printer_TerminusIndexBeforeBreak) (M.L.nuntius_printer_setTerminusIndex)
		{endif}
'play sound
		(M.L.nuntius_printer_playSoundNormal)
	{else}
'play sound
		(M.L.nuntius_printer_playSoundError)
		"Eingabe fehlerhaft" (S.$.nuntius_printer_ui_loadingInfo)
		98 (M.L.nuntius_printer_goToPage)
		71 (S.L.nuntius_printer_targetPage)
	{endif}
{end}

'Ends the shift
{macro:nuntius_printer_shiftEnd}
'Remove route data
	(M.L.nuntius_printer_removeTrip)
	(M.L.nuntius_printer_resetTerminus)
	1 (S.L.nuntius_ticketPrinting)
	
'logout driver
	(M.L.nuntius_printer_driverSwitch)
{end}

'switches the driver
{macro:nuntius_printer_driverSwitch}
'Reset statistics
	0
	(S.L.nuntius_printer_soldTicketsCount)
	(S.L.nuntius_printer_totalRevenue)
	(S.L.nuntius_printer_cancellationCount)

	1 (S.L.nuntius_ticketPrinting)
	0 (M.L.nuntius_printer_goToPage)
{end}

{macro:nuntius_printer_denyNextTrip}
	(M.L.nuntius_printer_removeTrip)
	2 (M.L.nuntius_printer_goToPage)
{end}

{macro:nuntius_printer_acceptNextTripWithBreak}
	(M.L.nuntius_printer_loadTTTrip)

	(L.L.nuntius_printer_hasHofFileOptions)
	{if}
		(M.L.nuntius_printer_startBreak)
	{endif}
	7 (M.L.nuntius_printer_goToPage)
{end}

'starts the break
{macro:nuntius_printer_startBreak}
	(L.L.nuntius_printer_TerminusIndex) (S.L.nuntius_printer_TerminusIndexBeforeBreak)
	(L.L.nuntius_printer_option_terminusCodeBreak) (M.L.nuntius_printer_setTerminus)
{end}

'Loads the Timetables trip
{macro:nuntius_printer_loadTTTrip}
	(L.L.schedule_active)
	{if}
'Get Terminus and line and save it to all needed sources
		(M.V.GetTTLineString) (S.$.IBIS_Complex_Line) (S.$.Matrix_Nr) (S.$.nuntius_printer_lineStr)
		(M.V.GetTTTerminusIndex) (M.L.nuntius_printer_setTerminusIndex)
		
'Save Mode
		1 (S.L.nuntius_printer_RouteMode)
		(M.L.nuntius_printer_refreshLineUI)
		(M.L.nuntius_printer_refreshBusstopList)

'Go back to Main Page
		2 (M.L.nuntius_printer_goToPage)
	{else}
'play sound
		(M.L.nuntius_printer_playSoundError)
	{endif}
{end}

'Loads a trip from the hof file
{macro:nuntius_printer_loadHofTrip}
'Register:
'0 = Line
'1 = Route
'2 = Suffix
'3 = Route index

	0 (S.L.nuntius_printer_currentBusstopIndex)

	(L.$.nuntius_printer_ui_input0) $StrToFloat s0
	(L.$.nuntius_printer_ui_input1) $StrToFloat s1
	(L.$.nuntius_printer_ui_input2) $StrToFloat s2

'Get Route Index
	l0 100 * l1 + (M.V.GetRouteIndex) s3

'if route exists
	-1 = !
	{if}	
'Save IBIS Line (for Matrix needed)
	l0 100 * l2 + (S.L.IBIS_Linie_Complex)
	l2 (S.L.IBIS_Linie_Suffix)

'Save all data
		l0 (S.L.nuntius_printer_Line) $IntToStr (S.$.nuntius_printer_lineStr)
		l1 (S.L.nuntius_printer_Route)
		l2 (S.L.nuntius_printer_Suffix)
		l3 (S.L.nuntius_printer_RouteIndex)

'Get Terminus
		(M.V.GetRouteTerminusIndex) (M.L.nuntius_printer_setTerminusIndex)
		
'Save Mode
		2 (S.L.nuntius_printer_RouteMode)
		(M.L.nuntius_printer_refreshLineUI)
		(M.L.nuntius_printer_refreshBusstopList)
		
'Go back to Main Page
		2 (M.L.nuntius_printer_goToPage)
'play sound
		(M.L.nuntius_printer_playSoundNormal)
	{else}
'play sound
		(M.L.nuntius_printer_playSoundError)
	{endif}
{end}

'removes the trip from printer
{macro:nuntius_printer_removeTrip}
'Set everything to 0
	""
	0
	(S.L.nuntius_printer_RouteMode)
	(S.L.nuntius_printer_Line)
	(S.L.nuntius_printer_Route)
	(S.L.nuntius_printer_Suffix)
	(S.L.nuntius_printer_Terminus)
	(S.L.nuntius_printer_currentBusstopIndex)
	(S.L.nuntius_printer_busstopOffset)
	(S.L.IBIS_TerminusIndex)
	(S.L.IBIS_Linie_Complex)
	(S.L.IBIS_Linie_Suffix)
	(S.L.target_index_int)
	(S.$.nuntius_printer_lineStr)

	(M.L.nuntius_printer_resetTerminus)

	(M.L.nuntius_printer_refreshBusstopList)

'Go back to Main Page
	2 (M.L.nuntius_printer_goToPage)

'play sound
	(M.L.nuntius_printer_playSoundNormal)
{end}

'sets a special terminus
{macro:nuntius_printer_specialTerminus}
'Register:
'0 = Terminus Code
'1 = Terminus Index

	(L.$.nuntius_printer_ui_input0) $StrToFloat s0
	(M.V.GetTerminusIndex) s1

	-1 = !
	{if}
		l0 (M.L.nuntius_printer_setTerminus)
		(M.L.nuntius_printer_refreshLineUI)
		l1 (S.L.target_index_int) (S.L.IBIS_TerminusIndex) (S.L.nuntius_printer_TerminusIndex)
		l0 (S.L.nuntius_printer_Terminus)
		(M.L.nuntius_printer_playSoundNormal)
'set mode
		1 (S.L.nuntius_printer_specialTerminus)
'go to home page
		2 (M.L.nuntius_printer_goToPage)
	{else}
		(M.L.nuntius_printer_playSoundError)
	{endif}
{end}

'resets the terminus to the routes default
{macro:nuntius_printer_resetTerminus}

	(L.L.nuntius_printer_RouteMode) 0 =
	{if}
		0 (M.L.nuntius_printer_setTerminusIndex)
	{else}
		(L.L.nuntius_printer_RouteIndex) (M.V.GetRouteTerminusIndex) (M.L.nuntius_printer_setTerminusIndex)
	{endif}
	(M.L.nuntius_printer_refreshLineUI)

'set mode
	0 (S.L.nuntius_printer_specialTerminus)

'go back to home page
	2 (M.L.nuntius_printer_goToPage)
{end}

'sets a terminus by index
'Arguments:
'0 = the terminus index
{macro:nuntius_printer_setTerminusIndex}
	(M.V.GetTerminusCode) (M.L.nuntius_printer_setTerminus)
{end}

'sets the terminus to the given code
'Arguments:
'0 = the terminus code
{macro:nuntius_printer_setTerminus}
'Register:
'0 = Code
'1 = Index
	s0
	(M.V.GetTerminusIndex) s1
'if the index is not -1
	-1 = !
	{if}
'save data
		l0 (S.L.nuntius_printer_Terminus)
		l1 (S.L.nuntius_printer_TerminusIndex) (S.L.IBIS_TerminusIndex) (S.L.target_index_int)
'set ui's terminus string
		(L.L.nuntius_printer_TerminusIndex) 1 (M.V.GetTerminusString) $RemoveSpaces (S.$.nuntius_printer_ui_terminus1)
		(L.L.nuntius_printer_TerminusIndex) 2 (M.V.GetTerminusString) $RemoveSpaces (S.$.nuntius_printer_ui_terminus2)

		(L.L.nuntius_printer_TerminusIndex) 5 (M.V.GetTerminusString)
	{endif}
{end}

'refreshs the textbox that shows line, route, terminus code and co
{macro:nuntius_printer_refreshLineUI}
	(L.L.nuntius_printer_RouteMode) 1 =
	{if}
		(L.$.nuntius_printer_lineStr) (S.$.nuntius_printer_ui_line1)
		(L.L.nuntius_printer_Terminus) "03" $IntToStrEnh (S.$.nuntius_printer_ui_line2)
	{else}
		(L.L.nuntius_printer_Line) $IntToStr "/" $+ (L.L.nuntius_printer_Suffix) "02" $IntToStrEnh $+ (S.$.nuntius_printer_ui_line1)
		(L.L.nuntius_printer_Route) "02" $IntToStrEnh "/" $+ (L.L.nuntius_printer_Terminus) "03" $IntToStrEnh $+ (S.$.nuntius_printer_ui_line2)
	{endif}

'Schedule Scripttex for update
	(M.L.nuntius_printer_scheduleScriptTextForUpdate)
{end}

'refreshs the terminus selections preview (currently not in use!)
{macro:nuntius_printer_refreshTerminusPreview}
	(L.L.nuntius_printer_page) 5 =
	{if}
		(L.$.nuntius_printer_ui_input0) $StrToFloat
		(M.V.GetTerminusIndex) s0

		l0 1 (M.V.GetTerminusString) "@" $+
		l0 2 (M.V.GetTerminusString) $+
		(S.$.nuntius_printer_ui_terminusPreview)
	{endif}
{end}

'Updates the current Busstop index (if schedule is active and the current busstop changes)
{macro:nuntius_printer_updateCurrentBusstopIndex}
	(L.L.schedule_active)
	{if}
		(M.V.GetTTBusstopIndex) s0 (L.L.nuntius_printer_currentBusstopIndex) = !
		{if}
			(L.L.nuntius_printer_AutoHFSDisabled) !
			{if}
				l0
				(S.L.nuntius_printer_currentBusstopIndex)
				(M.L.nuntius_printer_playBusstopAnnouncement)
				(M.L.nuntius_printer_refreshBusstopList)
				1 (S.L.nuntius_event_queue_currentBusstopChanged)
			{endif}
			(M.L.nuntius_printer_restartDistanceCalc)
		{endif}
	{else}
		-1 (S.L.nuntius_printer_distance_nextBusstopDistance)
	{endif}
{end}

'Jumps to a certain busstop
'Arguments:
'0 = where we do want to jump (+2 = 2 up, -1 = 1 down)
{macro:nuntius_printer_busstopJump}

'Register:
'0 = how much busstops to jump (+2 = 2 up, -1 = 1 down)
'1 = target busstop offset (if schedule is used) or target busstop index (if no schedule is set)
'2 = the routes busstop count

	s0

'set target offset/index
	(L.L.schedule_active)
	{if}
		(L.L.nuntius_printer_busstopOffset) l0 + s1
	{else}
		(L.L.nuntius_printer_currentBusstopIndex) l0 + s1
	{endif}

'determine busstop count
	(L.L.nuntius_printer_RouteMode) 1 =
	{if}
		(M.V.GetTTBusstopCount) s2
	{else}
		(L.L.nuntius_printer_RouteMode) 2 =
		{if}
			(L.L.nuntius_printer_RouteIndex) (M.V.GetBusstopCount) s2
		{else}
			0 s2
		{endif}
	{endif}

	(L.L.schedule_active)
	{if}
'if target busstop is in valid range
		l1 (L.L.nuntius_printer_currentBusstopIndex) + l2 < l1 (L.L.nuntius_printer_currentBusstopIndex) + 0 >= &&
		{if}
			l1 (S.L.nuntius_printer_busstopOffset)
'play sound
			(M.L.nuntius_printer_playSoundNormal)
		{endif}
	{else}
'if target busstop is in valid range
		l1 l2 < l1 0 >= &&
		{if}
			l1 (S.L.nuntius_printer_currentBusstopIndex)
'play sound
			(M.L.nuntius_printer_playSoundNormal)
		{endif}
	{endif}
	(M.L.nuntius_printer_playBusstopAnnouncement)
	(M.L.nuntius_printer_refreshBusstopList)
{end}


'Plays a special announcement
'Arguments:
'0 = announcement index
{macro:nuntius_printer_playSpecialAnnouncement}
	s0

	"..\..\Announcements\" 0 (M.V.GetDepotStringGlobal) $+ "\nuntius\" $+

	l0 0 =
	{if}
		"Ansage_Tueren_freihalten.wav"
	{endif}

	l0 1 =
	{if}
		"Ansage_Nach_hinten_durchgehen.wav"
	{endif}

	l0 2 =
	{if}
		"Ansage_Umleitung.wav"
	{endif}

	l0 3 =
	{if}
		"Ansage_Fahrtende.wav"
	{endif}

	$+

	(T.F.nuntius_busstop_announcement)
	(M.L.nuntius_printer_playSoundNormal)

	2 (M.L.nuntius_printer_goToPage)
{end}

'Play the current busstop's announcement
{macro:nuntius_printer_playBusstopAnnouncement}
'only, if announcements are active
	(L.L.nuntius_printer_AnnouncementsAreActive)
	{if}
'build path
		"..\..\Announcements\" 0 (M.V.GetDepotStringGlobal) $+ "\" $+

		(L.L.nuntius_printer_RouteMode) 1 =
		{if}
			(L.L.nuntius_printer_currentBusstopIndex) (L.L.nuntius_printer_busstopOffset) +
			(M.V.GetTTBusstopName)
		{endif}

		(L.L.nuntius_printer_RouteMode) 2 =
		{if}
			(L.L.nuntius_printer_RouteIndex)
			(L.L.nuntius_printer_currentBusstopIndex) (L.L.nuntius_printer_busstopOffset) +
			(M.V.GetRouteBusstopIdent)
		{endif}
		$+

'if it's the last busstop, add "_#terminus" suffix
		(L.L.nuntius_printer_RouteMode) 1 =
		(M.V.GetTTBusstopCount) 1 - (L.L.nuntius_printer_currentBusstopIndex) (L.L.nuntius_printer_busstopOffset) + <= &&

		(L.L.nuntius_printer_RouteMode) 2 =
		(L.L.nuntius_printer_RouteIndex) (M.V.GetBusstopCount) 1 - (L.L.nuntius_printer_currentBusstopIndex) (L.L.nuntius_printer_busstopOffset) + <= && ||
		{if}
			"_#terminus" $+
		{endif}

'add file extention
		".wav" $+

'play sound
		(T.F.nuntius_busstop_announcement)
	{endif}
{end}

'Refreshs the printers busstop list
{macro:nuntius_printer_refreshBusstopList}
	(L.L.nuntius_printer_RouteMode) 0 =
	{if}
		""
		(S.$.nuntius_printer_ui_busstop0)
		(S.$.nuntius_printer_ui_busstop1)
		(S.$.nuntius_printer_ui_busstop2)
		(S.$.nuntius_printer_ui_busstop3)
		(S.$.nuntius_printer_ui_busstop4)
		(S.$.nuntius_printer_ui_busstop_end)
	{endif}

	(L.L.nuntius_printer_RouteMode) 1 = (L.L.nuntius_printer_RouteMode) 2 = ||
	{if}
		(L.L.schedule_active) {if} 258 {else} 352 {endif} s7

'				Index/Fallback Name								Get IBIS String/Fallback Name					Font					 width			shorten									save
		0 (M.L.nuntius_printer_getBusstopListEntry)   3 (M.L.nuntius_printer_getBusstopIndexString) (L.L.nuntius_printer_font_38pxMedium)  l7 (M.L.nuntius_printer_shortenString) (S.$.nuntius_printer_ui_busstop0)
		1 (M.L.nuntius_printer_getBusstopListEntry)   3 (M.L.nuntius_printer_getBusstopIndexString) (L.L.nuntius_printer_font_38pxRegular) l7 (M.L.nuntius_printer_shortenString) (S.$.nuntius_printer_ui_busstop1)
		2 (M.L.nuntius_printer_getBusstopListEntry)   3 (M.L.nuntius_printer_getBusstopIndexString) (L.L.nuntius_printer_font_38pxRegular) l7 (M.L.nuntius_printer_shortenString) (S.$.nuntius_printer_ui_busstop2)
		3 (M.L.nuntius_printer_getBusstopListEntry)   3 (M.L.nuntius_printer_getBusstopIndexString) (L.L.nuntius_printer_font_38pxRegular) l7 (M.L.nuntius_printer_shortenString) (S.$.nuntius_printer_ui_busstop3)
		4 (M.L.nuntius_printer_getBusstopListEntry)   3 (M.L.nuntius_printer_getBusstopIndexString) (L.L.nuntius_printer_font_38pxRegular) l7 (M.L.nuntius_printer_shortenString) (S.$.nuntius_printer_ui_busstop4)
		(M.L.nuntius_printer_getLastBusstopListEntry) 3 (M.L.nuntius_printer_getBusstopIndexString) (L.L.nuntius_printer_font_38pxMedium)  l7 (M.L.nuntius_printer_shortenString) (S.$.nuntius_printer_ui_busstop_end)
	{endif}

	(M.L.nuntius_printer_refreshBusstopTimeList)

'Schedule Scripttex for update
	(M.L.nuntius_printer_scheduleScriptTextForUpdate)
{end}


'returns the name of a busstop from the printers busstop list
'Arguments:
'0 = Field index (0-4, 0 = current, 4 = "most future")
'Returns:
'If the busstop was found in hof file: the busstops hof file index
'Else: the fallback name and "-1" as index
{macro:nuntius_printer_getBusstopListEntry}
'Register:
'0 = Field index (0-4, 0 = current, 4 = "most future")
'1 = target busstop route index
'2 = The Routes index
'3 = The busstop index in the hof file

	s0

'if the route mode is 2 (route from hof file)
	(L.L.nuntius_printer_RouteMode) 2 =
	{if}
'load all values for register
		(L.L.nuntius_printer_currentBusstopIndex) l0 + (L.L.nuntius_printer_busstopOffset) + s1
		(L.L.nuntius_printer_RouteIndex) s2
		
'if the busstop count is bigger than the target index (which means the busstop will exist)
		(M.V.GetBusstopCount) l1 >
		{if}
'get the busstops index
			l2
			l1
			(M.V.GetRouteBusstopIdent)
			(M.V.GetBusstopIndex)
			""
		{else}
'else return nullstring
			""
			-1
		{endif}
	{else}
		(L.L.nuntius_printer_RouteMode) 1 =
		{if}
'load all values for register
			(L.L.nuntius_printer_currentBusstopIndex) l0 + (L.L.nuntius_printer_busstopOffset) + s1
			
'if the busstop count is bigger than the target index (which means the busstop will exist)
			(M.V.GetTTBusstopCount) l1 >
			{if}
'get the busstops index (or give fallback name if it was not found)
				l1
				(M.V.GetTTBusstopName) (M.V.GetBusstopIndex) s3 -1 = !
				{if}
					l3
					""
				{else}
					l1 (M.V.GetTTBusstopName)
					-1
				{endif}
			{else}
'else return nullstring
				""
				-1
			{endif}
		{else}
			""
			-1
		{endif}
	{endif}
{end}

'Returns:
'If the busstop was found in hof file: the busstops hof file index
'Else: the fallback name and "-1" as index
{macro:nuntius_printer_getLastBusstopListEntry}
'Register:
'0 = <unused>
'1 = target busstop route index
'3 = The busstop index in the hof file

	(L.L.nuntius_printer_RouteMode) 0 = !
	{if}
		(L.L.nuntius_printer_RouteMode) 1 =
		{if}
			(M.V.GetTTBusstopCount) 1 - s1 (M.V.GetTTBusstopName) (M.V.GetBusstopIndex) s3 -1 = !
			{if}
				l3
				""
			{else}
				l1 (M.V.GetTTBusstopName)
				-1
			{endif}
		{else}
			(L.L.nuntius_printer_RouteIndex) s0 (M.V.GetBusstopCount) 1 - s1 l0 l1 (M.V.GetRouteBusstopIdent) (M.V.GetBusstopIndex)
			""
		{endif}
	{else}
		""
		-1
	{endif}
{end}

'If not "-1" searches for the busstop and returns the string, otherwise does no change to the string stack
'(which is useful so if you call this after getBusstopListEntry, the fallback string will stay after calling)
'Arguments:
'1 = hof file index of the busstop
'0 = string index
{macro:nuntius_printer_getBusstopIndexString}
	s0
	+ l0 - s1

	0 >=
	{if} l1 l0 (M.V.GetBusstopString) {endif}
	$RemoveSpaces
{end}


'Refreshs the printers busstop times list
{macro:nuntius_printer_refreshBusstopTimeList}
	(L.L.nuntius_printer_RouteMode) 0 = 
	{if}
		""
		(S.$.nuntius_printer_ui_busstopTime0)
		(S.$.nuntius_printer_ui_busstopTime1)
		(S.$.nuntius_printer_ui_busstopTime2)
		(S.$.nuntius_printer_ui_busstopTime3)
		(S.$.nuntius_printer_ui_busstopTime4)
		(S.$.nuntius_printer_ui_busstopTime_end)
	{endif}

	(L.L.nuntius_printer_RouteMode) 1 = (L.L.nuntius_printer_RouteMode) 2 = ||
	{if}
		0 (M.L.nuntius_printer_getBusstopTimeListEntry) (S.$.nuntius_printer_ui_busstopTime0)
		1 (M.L.nuntius_printer_getBusstopTimeListEntry) (S.$.nuntius_printer_ui_busstopTime1)
		2 (M.L.nuntius_printer_getBusstopTimeListEntry) (S.$.nuntius_printer_ui_busstopTime2)
		3 (M.L.nuntius_printer_getBusstopTimeListEntry) (S.$.nuntius_printer_ui_busstopTime3)
		4 (M.L.nuntius_printer_getBusstopTimeListEntry) (S.$.nuntius_printer_ui_busstopTime4)
		(M.L.nuntius_printer_getLastBusstopTimeListEntry) (S.$.nuntius_printer_ui_busstopTime_end)
	{endif}
{end}

'returns the time of a busstop from the printers busstop list
'Arguments:
'0 = Field index (0-4, 0 = current, 4 = "most future")
'Returns String: The busstops time
{macro:nuntius_printer_getBusstopTimeListEntry}
'Register:
'0 = Field index (0-4, 0 = current, 4 = "most future")
'1 = target busstop route index
'2 = The Routes index
'3 = arr time
'4 = dep time

	s0

'if the route mode is 1 (route from hof file) or 2 (route from timetable)
	(L.L.nuntius_printer_RouteMode) 1 = (L.L.nuntius_printer_RouteMode) 2 = ||
	{if}
'load all values for register
		(L.L.nuntius_printer_currentBusstopIndex) l0 + (L.L.nuntius_printer_busstopOffset) + s1
		
'if the busstop count is bigger than the target index (which means the busstop will exist)
		(M.V.GetTTBusstopCount) l1 >
		{if}
'get the busstops time
			l1 (M.V.GetTTBusstopArr) 86400 % s3
			l1 (M.V.GetTTBusstopDep) 86400 % s4
			""
			
'write tep time
			l4 3600 / trunc "02" $IntToStrEnh ":" $+
			l4 3600 % 60 / trunc "02" $IntToStrEnh $+

'if arr time is different, write it also
'			l3 l4 = ! l3 -1 = ! &&
'			{if}
'				"@" $+
'				l3 3600 / trunc "02" $IntToStrEnh $+ ":" $+
'				l3 3600 % 60 / trunc "02" $IntToStrEnh $+ 
'			{endif}
		{else}
'else return nullstring
			""
		{endif}
	{endif}
{end}



{macro:nuntius_printer_getLastBusstopTimeListEntry}
	(L.L.nuntius_printer_RouteMode) 0 = ! (L.L.schedule_active) &&
	{if}
		(M.V.GetTTBusstopCount) 1 - (M.V.GetTTBusstopArr) 86400 % s0
		l0 3600 / trunc "02" $IntToStrEnh ":" $+
		l0 3600 % 60 / trunc "02" $IntToStrEnh $+
	{else}
		""
	{endif}
{end}

'################################
'distance calculation
'################################

{macro:nuntius_printer_restartDistanceCalc}
	(L.L.kmcounter_km) (S.L.nuntius_printer_distance_lastKmCounter_km)
	(L.L.kmcounter_m) (S.L.nuntius_printer_distance_lastKmCounter_m)
	5 (S.L.nuntius_printer_distance_timer)
	(M.L.nuntius_printer_recalculateDistance)
{end}

{macro:nuntius_printer_recalculateDistance}
	(L.L.nuntius_printer_distance_timer) (L.S.Timegap) + s0 1 % (S.L.nuntius_printer_distance_timer)
	
	l0 1 >=
	{if}
		(L.L.nuntius_printer_distance_nextBusstopDistance) (S.L.nuntius_printer_distance_nextBusstopDistanceLast)

		(M.V.GetTTBusstopIndex) s0 0 =
		{if}
			-1 (S.L.nuntius_printer_distance_nextBusstopDistance)
		{else}
'Register use:
'0 = current busstop index
'1 = current delay (in seconds)
'2 = actual dep time at last busstop (actually not actual but how it would've been according to the current delay)
'3 = actual (predicted) arr time at next busstop
'4 = time difference between last and next busstop (in seconds)
'5 = elapsed time since the last busstop was left (according to the current delay)
'6 = percent (0...1) where we are at the timeline between last and next busstop

'fetch delay
			(M.V.GetTTDelay) s1
			
'calculate actual dep at last busstop and arr at current one (schedule time + delay)
			l0 1 - (M.V.GetTTBusstopDep) 86400 % l1 + s2
			l0 (M.V.GetTTBusstopArr) 86400 % l1 + s3

'calc differences
			l3 l2 - s4
			(L.S.Time) l2 - s5

'get relative value where we are on our "timeline"
			l5 l4 / s6

'Register use (changes from here):
'2 = difference actual meters (including the kilometer difference)
'7 = calculated total distance between last and next busstop

'calc distance diferences
			(L.L.kmcounter_km) (L.L.nuntius_printer_distance_lastKmCounter_km) - 1000 *
			(L.L.kmcounter_m) (L.L.nuntius_printer_distance_lastKmCounter_m) -
'...and join them into one value
			+ s2

'calc total busstop distance
			l2 l6 / s7

'...and subtract the value we already reached from it
			l7 l2 - (S.L.nuntius_printer_distance_nextBusstopDistance)
		{endif}
	{endif}
{end}

'################################
'ticketprinter functions
'################################

'loads all tickets
{macro:nuntius_printer_loadTickets}
	0 (M.V.GetTicketValue) 0 = ! {if} 0 (M.V.GetTicketName) (L.L.nuntius_printer_font_38pxRegular) 214 (M.L.nuntius_printer_shortenString) {else} "" {endif} (S.$.nuntius_printer_ui_ticketName0)
	1 (M.V.GetTicketValue) 0 = ! {if} 1 (M.V.GetTicketName) (L.L.nuntius_printer_font_38pxRegular) 214 (M.L.nuntius_printer_shortenString) {else} "" {endif} (S.$.nuntius_printer_ui_ticketName1)
	2 (M.V.GetTicketValue) 0 = ! {if} 2 (M.V.GetTicketName) (L.L.nuntius_printer_font_38pxRegular) 214 (M.L.nuntius_printer_shortenString) {else} "" {endif} (S.$.nuntius_printer_ui_ticketName2)
	3 (M.V.GetTicketValue) 0 = ! {if} 3 (M.V.GetTicketName) (L.L.nuntius_printer_font_38pxRegular) 214 (M.L.nuntius_printer_shortenString) {else} "" {endif} (S.$.nuntius_printer_ui_ticketName3)
	4 (M.V.GetTicketValue) 0 = ! {if} 4 (M.V.GetTicketName) (L.L.nuntius_printer_font_38pxRegular) 214 (M.L.nuntius_printer_shortenString) {else} "" {endif} (S.$.nuntius_printer_ui_ticketName4)
	5 (M.V.GetTicketValue) 0 = ! {if} 5 (M.V.GetTicketName) (L.L.nuntius_printer_font_38pxRegular) 214 (M.L.nuntius_printer_shortenString) {else} "" {endif} (S.$.nuntius_printer_ui_ticketName5)
	6 (M.V.GetTicketValue) 0 = ! {if} 6 (M.V.GetTicketName) (L.L.nuntius_printer_font_38pxRegular) 214 (M.L.nuntius_printer_shortenString) {else} "" {endif} (S.$.nuntius_printer_ui_ticketName6)
	7 (M.V.GetTicketValue) 0 = ! {if} 7 (M.V.GetTicketName) (L.L.nuntius_printer_font_38pxRegular) 214 (M.L.nuntius_printer_shortenString) {else} "" {endif} (S.$.nuntius_printer_ui_ticketName7)

	0 (M.V.GetTicketValue) 0 = ! {if} 0 (M.L.nuntius_printer_getTicketPrice) " " $+ {else} "" {endif} (S.$.nuntius_printer_ui_ticketPrice0)
	1 (M.V.GetTicketValue) 0 = ! {if} 1 (M.L.nuntius_printer_getTicketPrice) " " $+ {else} "" {endif} (S.$.nuntius_printer_ui_ticketPrice1)
	2 (M.V.GetTicketValue) 0 = ! {if} 2 (M.L.nuntius_printer_getTicketPrice) " " $+ {else} "" {endif} (S.$.nuntius_printer_ui_ticketPrice2)
	3 (M.V.GetTicketValue) 0 = ! {if} 3 (M.L.nuntius_printer_getTicketPrice) " " $+ {else} "" {endif} (S.$.nuntius_printer_ui_ticketPrice3)
	4 (M.V.GetTicketValue) 0 = ! {if} 4 (M.L.nuntius_printer_getTicketPrice) " " $+ {else} "" {endif} (S.$.nuntius_printer_ui_ticketPrice4)
	5 (M.V.GetTicketValue) 0 = ! {if} 5 (M.L.nuntius_printer_getTicketPrice) " " $+ {else} "" {endif} (S.$.nuntius_printer_ui_ticketPrice5)
	6 (M.V.GetTicketValue) 0 = ! {if} 6 (M.L.nuntius_printer_getTicketPrice) " " $+ {else} "" {endif} (S.$.nuntius_printer_ui_ticketPrice6)
	7 (M.V.GetTicketValue) 0 = ! {if} 7 (M.L.nuntius_printer_getTicketPrice) " " $+ {else} "" {endif} (S.$.nuntius_printer_ui_ticketPrice7)
{end}

'selects one ticket from menu
'Arguments:
'0 = index of the ticket, you want to select
{macro:nuntius_printer_selectTicket}
	s0

	(M.V.GetTicketValue) 0 = !
	{if}
		l0 (M.V.GetTicketName) (S.$.nuntius_printer_ui_currentTicketName)
		l0 (S.L.nuntius_printer_selectedTicket)
		l0 (M.L.nuntius_printer_getTicketPrice) " " $+
		(S.$.nuntius_printer_ui_currentTicketPrice)

'show detail view
		(L.$.nuntius_printer_currentDisplayTextureFolder) "Busstop_Ticket.dds" $+ (S.$.nuntius_printer_ui_texture)

'disable ticket list
		0 (M.L.nuntius_printer_showUiElementsTicketList)
		1 (M.L.nuntius_printer_showUiElementsTicketSelection)
		(L.$.nuntius_printer_currentDisplayTextureFolder)  "textColor\SelectTicket.dds" $+ (S.$.nuntius_printer_ui_textColorTexture)
		(M.L.nuntius_printer_scheduleScriptTextForUpdate)
	{endif}

'play sound
	(M.L.nuntius_printer_playSoundNormal)
{end}

'sells a ticket and prints it
{macro:nuntius_printer_barTicket}
	(L.L.nuntius_ticket) !
	{if}
'make Ticket visible
		1 (S.L.nuntius_ticket) (S.L.nuntius_ticketPrinting)
'		1 (S.L.nuntius_ticket) (S.L.nuntius_ticketAnim)
'save to pre-defined variable
		(L.L.nuntius_printer_selectedTicket) (S.L.nuntius_printer_givenTicket)
'increase counters
		(L.L.nuntius_printer_soldTicketsCount) 1 + (S.L.nuntius_printer_soldTicketsCount)
		(L.L.nuntius_printer_selectedTicket) (M.V.GetTicketValue) s0
		(L.L.nuntius_printer_totalRevenue) l0 + (S.L.nuntius_printer_totalRevenue)
'go back to busstop page
		3 (M.L.nuntius_printer_goToPage)
'play sound
		(M.L.nuntius_printer_playSoundNormal)
	{else}
'play sound
		(M.L.nuntius_printer_playSoundError)
	{endif}
{end}

'cancels a ticket and prints the "storno"
{macro:nuntius_printer_cancelTicket}
	(L.L.nuntius_ticket) !
	{if}
'make Ticket visible
		1 (S.L.nuntius_ticket) (S.L.nuntius_ticketPrinting)
'save to pre-defined variable
		-1 (S.L.GivenTicket) (S.L.nuntius_printer_givenTicket)
'de-/increase counters
		(L.L.nuntius_printer_cancellationCount) 1 + (S.L.nuntius_printer_cancellationCount)
		(L.L.nuntius_printer_selectedTicket) (M.V.GetTicketValue) s0
		(L.L.nuntius_printer_totalRevenue) l0 - (S.L.nuntius_printer_totalRevenue)
'go back to busstop page
		3 (M.L.nuntius_printer_goToPage)
'play sound
		(M.L.nuntius_printer_playSoundNormal)
	{else}
'play sound
		(M.L.nuntius_printer_playSoundError)
	{endif}
{end}

'returns a ticket's price as a string
'Arguments:
'0 = the ticket index
'Returns string = the ticket's price (e.g. "2,70")
{macro:nuntius_printer_getTicketPrice}
	s0

	(M.V.GetTicketValue) 0 = !
	{if}
'get full ? as string (for example: 2.70 -> "2")
		l0 (M.V.GetTicketValue) s0 $IntToStr "," $+

'multiply price with 100 (2.70 -> 270), turn into string and cut of the last two characters
		l0 100 * $IntToStr 2 $SetLengthR

'add to string
		$+
	{else}
		""
	{endif}
{end}

'handles the ticket printing
{macro:nuntius_ticketPrintHandler}
'only if we are printing a ticket
	(L.L.nuntius_ticketPrinting)
	{if}
'if the print is still finished
		(L.L.nuntius_ticketAnim) 1 >=
		{if}
'say omsi, that the ticket finished printing
			(L.L.nuntius_printer_givenTicket) (S.L.GivenTicket)
			1 (S.L.nuntius_ticketAnim)
'reset timer
			0 (S.L.nuntius_ticketPrintingTimer) (S.L.nuntius_ticketPrinting)
		{else}
'first we need to make the ticket visible
			1 (S.L.nuntius_ticket)
'if we just startet printing, play sound
			(L.L.nuntius_ticketPrintingTimer) 0 =
			{if}
				(T.L.nuntius_ticket_print)
			{endif}
'increase timer
			(L.L.nuntius_ticketPrintingTimer) (L.S.Timegap) + (S.L.nuntius_ticketPrintingTimer)
'refresh anim value (multiplied with 2, because it's "Kehrwert" is 0,5 which results in the fact,
'that the whole printing proccess will be 0,5 seconds long)
			2 * (S.L.nuntius_ticketAnim)
		{endif}
	{endif}
{end}


'################################
'home functions
'################################

'turns the auto "Haltestellenfortschaltung" on or off
{macro:nuntius_printer_toggleAutoHFS}
	(L.L.nuntius_printer_page) 2 = (L.L.schedule_active) &&
	{if}
		(L.L.nuntius_printer_AutoHFSDisabled) ! (S.L.nuntius_printer_AutoHFSDisabled)
		{if}
			(L.$.nuntius_printer_currentDisplayTextureFolder) "Home_noHFS.dds" $+ (S.$.nuntius_printer_ui_texture)
		{else}
			(L.$.nuntius_printer_currentDisplayTextureFolder) "Home.dds" $+ (S.$.nuntius_printer_ui_texture)
		{endif}

		(M.L.nuntius_printer_playSoundNormal)
	{endif}
{end}

'Opens the "please wait" page and then goes to the page specified
'Arguments:
'1 = page id
'0 = wait time in seconds
{macro:nuntius_printer_goToPageAfterWaitTime}
	s1 + l1 - (S.L.nuntius_printer_targetPage)
	l1 (S.L.nuntius_printer_pleaseWaitDuration)
	0 (S.L.nuntius_printer_pleaseWaitTimer)
	-1 (S.L.nuntius_printer_pleaseWaitReason)
{end}

'Starts a wait time with the given arguments:
'1 = wait reason
'0 = wait time in seconds
{macro:nuntius_printer_startWaitTime}
	s1 + l1 - (S.L.nuntius_printer_pleaseWaitReason) s0
	l1 (S.L.nuntius_printer_pleaseWaitDuration)
	0 (S.L.nuntius_printer_pleaseWaitTimer)

	l0 -1 =           {if} "Bitte warten..."                {endif}
	l0  0 =           {if} "Fahrerkarte wird eingelesen..." {endif}
	l0  1 = l0 2 = || {if} "Login wird überprüft..."        {endif}
	l0  3 = l0 4 = || {if} "Eingaben werden übermittelt..." {endif}
	l0  5 =           {if} "Ticket wird gedruckt..."        {endif}
	(S.$.nuntius_printer_ui_loadingInfo)

	99 (M.L.nuntius_printer_goToPage)
{end}

'Opens a specified page
'Arguments:
'0 = page id
{macro:nuntius_printer_goToPage}
'(X) = not implemented
'0 = welcome page
'1 = login page
'2 = home page
'3 = busstop page
'4 = LKR
'5 = special terminus
'6 = announcements
'7 = pause
'71 = login after pause
'8 = Funk (X)
'9 = DriverSwitch
'10 = Shift end
'11 = departure
'12 = confirm next trip
'91/101 = logout pin after shift end or driver switch
'20 = Menu (X)

	s0

'only do if printer is active
	(L.L.nuntius_printer_bootStatus) 2 = (L.L.nuntius_printer_bootStatus) 3 = ||
	{if}
		l0 (S.L.nuntius_printer_page)
		(M.L.nuntius_printer_scheduleScriptTextForUpdate)

'0: Welcome Page
		l0 0 =
		{if}
			(L.$.nuntius_printer_currentDisplayTextureFolder) "Welcome.dds" $+ (S.$.nuntius_printer_ui_texture)
			(L.$.nuntius_printer_currentDisplayTextureFolder)  "textColor\Default.dds" $+ (S.$.nuntius_printer_ui_textColorTexture)

			1 (M.L.nuntius_printer_showUiElementsCompanyLogo)
			1 (M.L.nuntius_printer_showUiElementsTime)
			0 (M.L.nuntius_printer_showUiElementsDelay)
			0 (M.L.nuntius_printer_showUiElementsLineInformation)
			0 (M.L.nuntius_printer_showUiElementsBusstopList)
			0 (M.L.nuntius_printer_showUiElementsHomeButtons)
			0 (M.L.nuntius_printer_showUiElementsButtonBack)
			0 (M.L.nuntius_printer_showUiElementsButtonApply)
			0 (M.L.nuntius_printer_showUiElementsButtonReset)
			0 (M.L.nuntius_printer_showUiElementsButtonAuto)
			0 (M.L.nuntius_printer_showUiElementsButtonMenu)
			0 (M.L.nuntius_printer_showUiElementsButtonBusstopMenu)
			0 (M.L.nuntius_printer_showUiElementsTicketList)
			0 (M.L.nuntius_printer_showUiElementsTicketSelection)
			0 (M.L.nuntius_printer_showUiElementsBusstopFooter)
			0 (M.L.nuntius_printer_showUiElementsInput0)
			0 (M.L.nuntius_printer_showUiElementsInput1)
			0 (M.L.nuntius_printer_showUiElementsInput2)
			0 (M.L.nuntius_printer_showUiElementsNumpad)
			0 (M.L.nuntius_printer_showUiElementsLoadingInfo)
			0 (M.L.nuntius_printer_showUiElementsAnnouncements)
			0 (M.L.nuntius_printer_showUiConfirmNextTrip)
			0 (M.L.nuntius_printer_showUiMenuNav)
			0 (M.L.nuntius_printer_showUiBusstopDistance)
		{endif}
		
'1: Login Page
		l0 1 =
		{if}
			(L.$.nuntius_printer_currentDisplayTextureFolder) "Login_withID_PIN.dds" $+ (S.$.nuntius_printer_ui_texture)
			(L.$.nuntius_printer_currentDisplayTextureFolder)  "textColor\Input.dds" $+ (S.$.nuntius_printer_ui_textColorTexture)
			
			0 (M.L.nuntius_printer_showUiElementsCompanyLogo)
			1 (M.L.nuntius_printer_showUiElementsTime)
			0 (M.L.nuntius_printer_showUiElementsDelay)
			0 (M.L.nuntius_printer_showUiElementsLineInformation)
			0 (M.L.nuntius_printer_showUiElementsBusstopList)
			0 (M.L.nuntius_printer_showUiElementsHomeButtons)
			1 (M.L.nuntius_printer_showUiElementsButtonBack)
			1 (M.L.nuntius_printer_showUiElementsButtonApply)
			0 (M.L.nuntius_printer_showUiElementsButtonReset)
			0 (M.L.nuntius_printer_showUiElementsButtonAuto)
			0 (M.L.nuntius_printer_showUiElementsButtonMenu)
			0 (M.L.nuntius_printer_showUiElementsButtonBusstopMenu)
			0 (M.L.nuntius_printer_showUiElementsTicketList)
			0 (M.L.nuntius_printer_showUiElementsTicketSelection)
			0 (M.L.nuntius_printer_showUiElementsBusstopFooter)
			1 (M.L.nuntius_printer_showUiElementsInput0)
			1 (M.L.nuntius_printer_showUiElementsInput1)
			0 (M.L.nuntius_printer_showUiElementsInput2)
			1 (M.L.nuntius_printer_showUiElementsNumpad)
			0 (M.L.nuntius_printer_showUiElementsLoadingInfo)
			0 (M.L.nuntius_printer_showUiElementsAnnouncements)
			0 (M.L.nuntius_printer_showUiConfirmNextTrip)
			0 (M.L.nuntius_printer_showUiMenuNav)
			0 (M.L.nuntius_printer_showUiBusstopDistance)
			
			2 (S.L.nuntius_printer_InputFieldCount)
			1 (S.L.nuntius_printer_currentInputField)
			1 (S.L.nuntius_printer_inputFieldsEnabled)
			2 (S.L.nuntius_printer_inputsCensored)

			(M.L.nuntius_printer_resetInputFields)
			(C.L.nuntius_printer_driverID) $IntToStr (S.$.nuntius_printer_ui_input0)
		{endif}
		
'2: Home Page
		l0 2 =
		{if}
			(L.L.schedule_active) ! (L.L.nuntius_printer_RouteMode) ! ||
			{if}
				(L.$.nuntius_printer_currentDisplayTextureFolder) "Home_disabledHFS.dds" $+ (S.$.nuntius_printer_ui_texture)
			{else}
				(L.L.nuntius_printer_AutoHFSDisabled)
				{if}
					(L.$.nuntius_printer_currentDisplayTextureFolder) "Home_noHFS.dds" $+ (S.$.nuntius_printer_ui_texture)
				{else}
					(L.$.nuntius_printer_currentDisplayTextureFolder) "Home.dds" $+ (S.$.nuntius_printer_ui_texture)
				{endif}
			{endif}
			(L.$.nuntius_printer_currentDisplayTextureFolder)  "textColor\Default.dds" $+ (S.$.nuntius_printer_ui_textColorTexture)
			
			0 (M.L.nuntius_printer_showUiElementsCompanyLogo)
			1 (M.L.nuntius_printer_showUiElementsTime)
			1 (M.L.nuntius_printer_showUiElementsDelay)
			1 (M.L.nuntius_printer_showUiElementsLineInformation)
			1 (M.L.nuntius_printer_showUiElementsBusstopList)
			1 (M.L.nuntius_printer_showUiElementsHomeButtons)
			0 (M.L.nuntius_printer_showUiElementsButtonBack)
			0 (M.L.nuntius_printer_showUiElementsButtonApply)
			0 (M.L.nuntius_printer_showUiElementsButtonReset)
			0 (M.L.nuntius_printer_showUiElementsButtonAuto)
			1 (M.L.nuntius_printer_showUiElementsButtonMenu)
			1 (M.L.nuntius_printer_showUiElementsButtonBusstopMenu)
			0 (M.L.nuntius_printer_showUiElementsTicketList)
			0 (M.L.nuntius_printer_showUiElementsTicketSelection)
			0 (M.L.nuntius_printer_showUiElementsBusstopFooter)
			0 (M.L.nuntius_printer_showUiElementsInput0)
			0 (M.L.nuntius_printer_showUiElementsInput1)
			0 (M.L.nuntius_printer_showUiElementsInput2)
			0 (M.L.nuntius_printer_showUiElementsNumpad)
			0 (M.L.nuntius_printer_showUiElementsLoadingInfo)
			0 (M.L.nuntius_printer_showUiElementsAnnouncements)
			0 (M.L.nuntius_printer_showUiConfirmNextTrip)
			0 (M.L.nuntius_printer_showUiMenuNav)
			1 (M.L.nuntius_printer_showUiBusstopDistance)
		{endif}

'3: Busstop Page
		l0 3 =
		{if}
			(L.$.nuntius_printer_currentDisplayTextureFolder) "Busstop.dds" $+ (S.$.nuntius_printer_ui_texture)
			(L.$.nuntius_printer_currentDisplayTextureFolder)  "textColor\Default.dds" $+ (S.$.nuntius_printer_ui_textColorTexture)
			
			0 (M.L.nuntius_printer_showUiElementsCompanyLogo)
			1 (M.L.nuntius_printer_showUiElementsTime)
			1 (M.L.nuntius_printer_showUiElementsDelay)
			1 (M.L.nuntius_printer_showUiElementsLineInformation)
			1 (M.L.nuntius_printer_showUiElementsBusstopList)
			0 (M.L.nuntius_printer_showUiElementsHomeButtons)
			1 (M.L.nuntius_printer_showUiElementsButtonBack)
			0 (M.L.nuntius_printer_showUiElementsButtonApply)
			0 (M.L.nuntius_printer_showUiElementsButtonReset)
			0 (M.L.nuntius_printer_showUiElementsButtonAuto)
			1 (M.L.nuntius_printer_showUiElementsButtonMenu)
			1 (M.L.nuntius_printer_showUiElementsButtonBusstopMenu)
			1 (M.L.nuntius_printer_showUiElementsTicketList)
			0 (M.L.nuntius_printer_showUiElementsTicketSelection)
			1 (M.L.nuntius_printer_showUiElementsBusstopFooter)
			0 (M.L.nuntius_printer_showUiElementsInput0)
			0 (M.L.nuntius_printer_showUiElementsInput1)
			0 (M.L.nuntius_printer_showUiElementsInput2)
			0 (M.L.nuntius_printer_showUiElementsNumpad)
			0 (M.L.nuntius_printer_showUiElementsLoadingInfo)
			0 (M.L.nuntius_printer_showUiElementsAnnouncements)
			0 (M.L.nuntius_printer_showUiConfirmNextTrip)
			0 (M.L.nuntius_printer_showUiMenuNav)
			1 (M.L.nuntius_printer_showUiBusstopDistance)
		{endif}
		
'4: LKR Page
		l0 4 =
		{if}
			(L.$.nuntius_printer_currentDisplayTextureFolder) "LKR_man_Line.dds" $+ (S.$.nuntius_printer_ui_texture)
			(L.$.nuntius_printer_currentDisplayTextureFolder)  "textColor\Input.dds" $+ (S.$.nuntius_printer_ui_textColorTexture)
			
			0 (M.L.nuntius_printer_showUiElementsCompanyLogo)
			1 (M.L.nuntius_printer_showUiElementsTime)
			1 (M.L.nuntius_printer_showUiElementsDelay)
			1 (M.L.nuntius_printer_showUiElementsLineInformation)
			0 (M.L.nuntius_printer_showUiElementsBusstopList)
			0 (M.L.nuntius_printer_showUiElementsHomeButtons)
			1 (M.L.nuntius_printer_showUiElementsButtonBack)
			1 (M.L.nuntius_printer_showUiElementsButtonApply)
			1 (M.L.nuntius_printer_showUiElementsButtonReset)
			1 (M.L.nuntius_printer_showUiElementsButtonAuto)
			0 (M.L.nuntius_printer_showUiElementsButtonMenu)
			0 (M.L.nuntius_printer_showUiElementsButtonBusstopMenu)
			0 (M.L.nuntius_printer_showUiElementsTicketList)
			0 (M.L.nuntius_printer_showUiElementsTicketSelection)
			0 (M.L.nuntius_printer_showUiElementsBusstopFooter)
			1 (M.L.nuntius_printer_showUiElementsInput0)
			1 (M.L.nuntius_printer_showUiElementsInput1)
			1 (M.L.nuntius_printer_showUiElementsInput2)
			1 (M.L.nuntius_printer_showUiElementsNumpad)
			0 (M.L.nuntius_printer_showUiElementsLoadingInfo)
			0 (M.L.nuntius_printer_showUiElementsAnnouncements)
			0 (M.L.nuntius_printer_showUiConfirmNextTrip)
			0 (M.L.nuntius_printer_showUiMenuNav)
			0 (M.L.nuntius_printer_showUiBusstopDistance)
			
			3 (S.L.nuntius_printer_InputFieldCount)
			0 (S.L.nuntius_printer_currentInputField)
			1 (S.L.nuntius_printer_inputFieldsEnabled)
			0 (S.L.nuntius_printer_inputsCensored)
			
			(L.L.nuntius_printer_Line) $IntToStr (S.$.nuntius_printer_ui_input0)
			(L.L.nuntius_printer_Route) $IntToStr (S.$.nuntius_printer_ui_input1)
			(L.L.nuntius_printer_Suffix) $IntToStr (S.$.nuntius_printer_ui_input2)
		{endif}
		
'5: Terminus Page
		l0 5 =
		{if}
			(L.$.nuntius_printer_currentDisplayTextureFolder) "Terminus_Terminus.dds" $+ (S.$.nuntius_printer_ui_texture)
			(L.$.nuntius_printer_currentDisplayTextureFolder)  "textColor\Input.dds" $+ (S.$.nuntius_printer_ui_textColorTexture)
			
			0 (M.L.nuntius_printer_showUiElementsCompanyLogo)
			1 (M.L.nuntius_printer_showUiElementsTime)
			1 (M.L.nuntius_printer_showUiElementsDelay)
			1 (M.L.nuntius_printer_showUiElementsLineInformation)
			0 (M.L.nuntius_printer_showUiElementsBusstopList)
			0 (M.L.nuntius_printer_showUiElementsHomeButtons)
			1 (M.L.nuntius_printer_showUiElementsButtonBack)
			1 (M.L.nuntius_printer_showUiElementsButtonApply)
			1 (M.L.nuntius_printer_showUiElementsButtonReset)
			0 (M.L.nuntius_printer_showUiElementsButtonAuto)
			0 (M.L.nuntius_printer_showUiElementsButtonMenu)
			0 (M.L.nuntius_printer_showUiElementsButtonBusstopMenu)
			0 (M.L.nuntius_printer_showUiElementsTicketList)
			0 (M.L.nuntius_printer_showUiElementsTicketSelection)
			0 (M.L.nuntius_printer_showUiElementsBusstopFooter)
			1 (M.L.nuntius_printer_showUiElementsInput0)
			0 (M.L.nuntius_printer_showUiElementsInput1)
			0 (M.L.nuntius_printer_showUiElementsInput2)
			1 (M.L.nuntius_printer_showUiElementsNumpad)
			0 (M.L.nuntius_printer_showUiElementsLoadingInfo)
			0 (M.L.nuntius_printer_showUiElementsAnnouncements)
			0 (M.L.nuntius_printer_showUiConfirmNextTrip)
			0 (M.L.nuntius_printer_showUiMenuNav)
			0 (M.L.nuntius_printer_showUiBusstopDistance)
			
			1 (S.L.nuntius_printer_InputFieldCount)
			0 (S.L.nuntius_printer_currentInputField)
			1 (S.L.nuntius_printer_inputFieldsEnabled)
			0 (S.L.nuntius_printer_inputsCensored)

			(M.L.nuntius_printer_resetInputFields)
		{endif}

'6: Announcements
		l0 6 =
		{if}
			(L.L.nuntius_printer_AnnouncementsAreActive)
			{if}
				(L.$.nuntius_printer_currentDisplayTextureFolder) "Announcements_BusstopAnnouncementsOn.dds" $+ (S.$.nuntius_printer_ui_texture)
			{else}
				(L.$.nuntius_printer_currentDisplayTextureFolder) "Announcements_BusstopAnnouncementsOff.dds" $+ (S.$.nuntius_printer_ui_texture)
			{endif}
			(L.$.nuntius_printer_currentDisplayTextureFolder)  "textColor\Default.dds" $+ (S.$.nuntius_printer_ui_textColorTexture)
			
			0 (M.L.nuntius_printer_showUiElementsCompanyLogo)
			1 (M.L.nuntius_printer_showUiElementsTime)
			1 (M.L.nuntius_printer_showUiElementsDelay)
			1 (M.L.nuntius_printer_showUiElementsLineInformation)
			1 (M.L.nuntius_printer_showUiElementsBusstopList)
			0 (M.L.nuntius_printer_showUiElementsHomeButtons)
			1 (M.L.nuntius_printer_showUiElementsButtonBack)
			0 (M.L.nuntius_printer_showUiElementsButtonApply)
			0 (M.L.nuntius_printer_showUiElementsButtonReset)
			0 (M.L.nuntius_printer_showUiElementsButtonAuto)
			0 (M.L.nuntius_printer_showUiElementsButtonMenu)
			1 (M.L.nuntius_printer_showUiElementsButtonBusstopMenu)
			0 (M.L.nuntius_printer_showUiElementsTicketList)
			0 (M.L.nuntius_printer_showUiElementsTicketSelection)
			0 (M.L.nuntius_printer_showUiElementsBusstopFooter)
			0 (M.L.nuntius_printer_showUiElementsInput0)
			0 (M.L.nuntius_printer_showUiElementsInput1)
			0 (M.L.nuntius_printer_showUiElementsInput2)
			0 (M.L.nuntius_printer_showUiElementsNumpad)
			0 (M.L.nuntius_printer_showUiElementsLoadingInfo)
			1 (M.L.nuntius_printer_showUiElementsAnnouncements)
			0 (M.L.nuntius_printer_showUiConfirmNextTrip)
			0 (M.L.nuntius_printer_showUiMenuNav)
			1 (M.L.nuntius_printer_showUiBusstopDistance)
			
			0 (S.L.nuntius_printer_InputFieldCount)
			0 (S.L.nuntius_printer_currentInputField)
			0 (S.L.nuntius_printer_inputFieldsEnabled)

			(M.L.nuntius_printer_resetInputFields)
		{endif}

'7: Break Page
		l0 7 =
		{if}
			(L.$.nuntius_printer_currentDisplayTextureFolder) "Break.dds" $+ (S.$.nuntius_printer_ui_texture)
			(L.$.nuntius_printer_currentDisplayTextureFolder)  "textColor\Default.dds" $+ (S.$.nuntius_printer_ui_textColorTexture)

			1 (M.L.nuntius_printer_showUiElementsCompanyLogo)
			1 (M.L.nuntius_printer_showUiElementsTime)
			1 (M.L.nuntius_printer_showUiElementsDelay)
			1 (M.L.nuntius_printer_showUiElementsLineInformation)
			0 (M.L.nuntius_printer_showUiElementsBusstopList)
			0 (M.L.nuntius_printer_showUiElementsHomeButtons)
			0 (M.L.nuntius_printer_showUiElementsButtonBack)
			0 (M.L.nuntius_printer_showUiElementsButtonApply)
			0 (M.L.nuntius_printer_showUiElementsButtonReset)
			0 (M.L.nuntius_printer_showUiElementsButtonAuto)
			0 (M.L.nuntius_printer_showUiElementsButtonMenu)
			0 (M.L.nuntius_printer_showUiElementsButtonBusstopMenu)
			0 (M.L.nuntius_printer_showUiElementsTicketList)
			0 (M.L.nuntius_printer_showUiElementsTicketSelection)
			0 (M.L.nuntius_printer_showUiElementsBusstopFooter)
			0 (M.L.nuntius_printer_showUiElementsInput0)
			0 (M.L.nuntius_printer_showUiElementsInput1)
			0 (M.L.nuntius_printer_showUiElementsInput2)
			0 (M.L.nuntius_printer_showUiElementsNumpad)
			0 (M.L.nuntius_printer_showUiElementsLoadingInfo)
			0 (M.L.nuntius_printer_showUiElementsAnnouncements)
			0 (M.L.nuntius_printer_showUiConfirmNextTrip)
			0 (M.L.nuntius_printer_showUiMenuNav)
			0 (M.L.nuntius_printer_showUiBusstopDistance)
		{endif}

'8: Login from break page Page
		l0 71 =
		{if}
			(L.$.nuntius_printer_currentDisplayTextureFolder) "Login_withoutID_PIN.dds" $+ (S.$.nuntius_printer_ui_texture)
			(L.$.nuntius_printer_currentDisplayTextureFolder)  "textColor\Input.dds" $+ (S.$.nuntius_printer_ui_textColorTexture)
			
			0 (M.L.nuntius_printer_showUiElementsCompanyLogo)
			1 (M.L.nuntius_printer_showUiElementsTime)
			1 (M.L.nuntius_printer_showUiElementsDelay)
			1 (M.L.nuntius_printer_showUiElementsLineInformation)
			0 (M.L.nuntius_printer_showUiElementsBusstopList)
			0 (M.L.nuntius_printer_showUiElementsHomeButtons)
			1 (M.L.nuntius_printer_showUiElementsButtonBack)
			1 (M.L.nuntius_printer_showUiElementsButtonApply)
			0 (M.L.nuntius_printer_showUiElementsButtonReset)
			0 (M.L.nuntius_printer_showUiElementsButtonAuto)
			0 (M.L.nuntius_printer_showUiElementsButtonMenu)
			0 (M.L.nuntius_printer_showUiElementsButtonBusstopMenu)
			0 (M.L.nuntius_printer_showUiElementsTicketList)
			0 (M.L.nuntius_printer_showUiElementsTicketSelection)
			0 (M.L.nuntius_printer_showUiElementsBusstopFooter)
			1 (M.L.nuntius_printer_showUiElementsInput0)
			0 (M.L.nuntius_printer_showUiElementsInput1)
			0 (M.L.nuntius_printer_showUiElementsInput2)
			1 (M.L.nuntius_printer_showUiElementsNumpad)
			0 (M.L.nuntius_printer_showUiElementsLoadingInfo)
			0 (M.L.nuntius_printer_showUiElementsAnnouncements)
			0 (M.L.nuntius_printer_showUiConfirmNextTrip)
			0 (M.L.nuntius_printer_showUiMenuNav)
			0 (M.L.nuntius_printer_showUiBusstopDistance)
			
			1 (S.L.nuntius_printer_InputFieldCount)
			0 (S.L.nuntius_printer_currentInputField)
			1 (S.L.nuntius_printer_inputFieldsEnabled)
			1 (S.L.nuntius_printer_inputsCensored)
			(M.L.nuntius_printer_resetInputFields)
		{endif}

'9: Driver
		l0 9 =
		{if}
			(L.$.nuntius_printer_currentDisplayTextureFolder) "DriverSwitch.dds" $+ (S.$.nuntius_printer_ui_texture)
			(L.$.nuntius_printer_currentDisplayTextureFolder)  "textColor\Input.dds" $+ (S.$.nuntius_printer_ui_textColorTexture)
			
			0 (M.L.nuntius_printer_showUiElementsCompanyLogo)
			1 (M.L.nuntius_printer_showUiElementsTime)
			1 (M.L.nuntius_printer_showUiElementsDelay)
			1 (M.L.nuntius_printer_showUiElementsLineInformation)
			0 (M.L.nuntius_printer_showUiElementsBusstopList)
			0 (M.L.nuntius_printer_showUiElementsHomeButtons)
			1 (M.L.nuntius_printer_showUiElementsButtonBack)
			1 (M.L.nuntius_printer_showUiElementsButtonApply)
			0 (M.L.nuntius_printer_showUiElementsButtonReset)
			0 (M.L.nuntius_printer_showUiElementsButtonAuto)
			0 (M.L.nuntius_printer_showUiElementsButtonMenu)
			0 (M.L.nuntius_printer_showUiElementsButtonBusstopMenu)
			0 (M.L.nuntius_printer_showUiElementsTicketList)
			0 (M.L.nuntius_printer_showUiElementsTicketSelection)
			0 (M.L.nuntius_printer_showUiElementsBusstopFooter)
			1 (M.L.nuntius_printer_showUiElementsInput0)
			1 (M.L.nuntius_printer_showUiElementsInput1)
			1 (M.L.nuntius_printer_showUiElementsInput2)
			0 (M.L.nuntius_printer_showUiElementsNumpad)
			0 (M.L.nuntius_printer_showUiElementsLoadingInfo)
			0 (M.L.nuntius_printer_showUiElementsAnnouncements)
			0 (M.L.nuntius_printer_showUiConfirmNextTrip)
			0 (M.L.nuntius_printer_showUiMenuNav)
			0 (M.L.nuntius_printer_showUiBusstopDistance)
			
			3 (S.L.nuntius_printer_InputFieldCount)
			0 (S.L.nuntius_printer_currentInputField)
			0 (S.L.nuntius_printer_inputFieldsEnabled)
			0 (S.L.nuntius_printer_inputsCensored)
			
			(L.L.nuntius_printer_soldTicketsCount) $IntToStr (S.$.nuntius_printer_ui_input0)
			(L.L.nuntius_printer_cancellationCount) $IntToStr (S.$.nuntius_printer_ui_input1)

			(L.L.nuntius_printer_totalRevenue) $IntToStr "," $+

			(L.L.nuntius_printer_totalRevenue) 100 * $IntToStr 2 $SetLengthR $+ " " $+
			(S.$.nuntius_printer_ui_input2)
		{endif}

'10: Shift End
		l0 10 =
		{if}
			(L.$.nuntius_printer_currentDisplayTextureFolder) "ShiftEnd.dds" $+ (S.$.nuntius_printer_ui_texture)
			(L.$.nuntius_printer_currentDisplayTextureFolder)  "textColor\Input.dds" $+ (S.$.nuntius_printer_ui_textColorTexture)
			
			0 (M.L.nuntius_printer_showUiElementsCompanyLogo)
			1 (M.L.nuntius_printer_showUiElementsTime)
			1 (M.L.nuntius_printer_showUiElementsDelay)
			1 (M.L.nuntius_printer_showUiElementsLineInformation)
			0 (M.L.nuntius_printer_showUiElementsBusstopList)
			0 (M.L.nuntius_printer_showUiElementsHomeButtons)
			1 (M.L.nuntius_printer_showUiElementsButtonBack)
			1 (M.L.nuntius_printer_showUiElementsButtonApply)
			0 (M.L.nuntius_printer_showUiElementsButtonReset)
			0 (M.L.nuntius_printer_showUiElementsButtonAuto)
			0 (M.L.nuntius_printer_showUiElementsButtonMenu)
			0 (M.L.nuntius_printer_showUiElementsButtonBusstopMenu)
			0 (M.L.nuntius_printer_showUiElementsTicketList)
			0 (M.L.nuntius_printer_showUiElementsTicketSelection)
			0 (M.L.nuntius_printer_showUiElementsBusstopFooter)
			1 (M.L.nuntius_printer_showUiElementsInput0)
			1 (M.L.nuntius_printer_showUiElementsInput1)
			1 (M.L.nuntius_printer_showUiElementsInput2)
			0 (M.L.nuntius_printer_showUiElementsNumpad)
			0 (M.L.nuntius_printer_showUiElementsLoadingInfo)
			0 (M.L.nuntius_printer_showUiElementsAnnouncements)
			0 (M.L.nuntius_printer_showUiConfirmNextTrip)
			0 (M.L.nuntius_printer_showUiMenuNav)
			0 (M.L.nuntius_printer_showUiBusstopDistance)
			
			3 (S.L.nuntius_printer_InputFieldCount)
			0 (S.L.nuntius_printer_currentInputField)
			0 (S.L.nuntius_printer_inputFieldsEnabled)
			0 (S.L.nuntius_printer_inputsCensored)
			
			(L.L.nuntius_printer_soldTicketsCount) $IntToStr (S.$.nuntius_printer_ui_input0)
			(L.L.nuntius_printer_cancellationCount) $IntToStr (S.$.nuntius_printer_ui_input1)

			(L.L.nuntius_printer_totalRevenue) $IntToStr "," $+

			(L.L.nuntius_printer_totalRevenue) 100 * $IntToStr 2 $SetLengthR $+ " " $+
			(S.$.nuntius_printer_ui_input2)
		{endif}

'11: Departure
		l0 11 =
		{if}
			(L.$.nuntius_printer_currentDisplayTextureFolder) "Departure.dds" $+ (S.$.nuntius_printer_ui_texture)
			(L.$.nuntius_printer_currentDisplayTextureFolder)  "textColor\Default.dds" $+ (S.$.nuntius_printer_ui_textColorTexture)
			
			0 (M.L.nuntius_printer_showUiElementsCompanyLogo)
			1 (M.L.nuntius_printer_showUiElementsTime)
			1 (M.L.nuntius_printer_showUiElementsDelay)
			1 (M.L.nuntius_printer_showUiElementsLineInformation)
			1 (M.L.nuntius_printer_showUiElementsBusstopList)
			0 (M.L.nuntius_printer_showUiElementsHomeButtons)
			0 (M.L.nuntius_printer_showUiElementsButtonBack)
			1 (M.L.nuntius_printer_showUiElementsButtonApply)
			0 (M.L.nuntius_printer_showUiElementsButtonReset)
			0 (M.L.nuntius_printer_showUiElementsButtonAuto)
			1 (M.L.nuntius_printer_showUiElementsButtonMenu)
			0 (M.L.nuntius_printer_showUiElementsButtonBusstopMenu)
			0 (M.L.nuntius_printer_showUiElementsTicketList)
			0 (M.L.nuntius_printer_showUiElementsTicketSelection)
			0 (M.L.nuntius_printer_showUiElementsBusstopFooter)
			0 (M.L.nuntius_printer_showUiElementsInput0)
			0 (M.L.nuntius_printer_showUiElementsInput1)
			0 (M.L.nuntius_printer_showUiElementsInput2)
			0 (M.L.nuntius_printer_showUiElementsNumpad)
			0 (M.L.nuntius_printer_showUiElementsLoadingInfo)
			0 (M.L.nuntius_printer_showUiElementsAnnouncements)
			0 (M.L.nuntius_printer_showUiConfirmNextTrip)
			0 (M.L.nuntius_printer_showUiMenuNav)
			1 (M.L.nuntius_printer_showUiBusstopDistance)
			
			0 (S.L.nuntius_printer_InputFieldCount)
			0 (S.L.nuntius_printer_currentInputField)
			0 (S.L.nuntius_printer_inputFieldsEnabled)
		{endif}

'12: Confirm next Trip
		l0 12 =
		{if}
			(L.$.nuntius_printer_currentDisplayTextureFolder) "confirmNextTrip.dds" $+ (S.$.nuntius_printer_ui_texture)
			(L.$.nuntius_printer_currentDisplayTextureFolder)  "textColor\ConfirmNextTrip.dds" $+ (S.$.nuntius_printer_ui_textColorTexture)
			
			0 (M.L.nuntius_printer_showUiElementsCompanyLogo)
			1 (M.L.nuntius_printer_showUiElementsTime)
			0 (M.L.nuntius_printer_showUiElementsDelay)
			1 (M.L.nuntius_printer_showUiElementsLineInformation)
			1 (M.L.nuntius_printer_showUiElementsBusstopList)
			0 (M.L.nuntius_printer_showUiElementsHomeButtons)
			1 (M.L.nuntius_printer_showUiElementsButtonBack)
			1 (M.L.nuntius_printer_showUiElementsButtonApply)
			1 (M.L.nuntius_printer_showUiElementsButtonReset)
			1 (M.L.nuntius_printer_showUiElementsButtonAuto)
			1 (M.L.nuntius_printer_showUiElementsButtonMenu)
			0 (M.L.nuntius_printer_showUiElementsButtonBusstopMenu)
			0 (M.L.nuntius_printer_showUiElementsTicketList)
			0 (M.L.nuntius_printer_showUiElementsTicketSelection)
			0 (M.L.nuntius_printer_showUiElementsBusstopFooter)
			0 (M.L.nuntius_printer_showUiElementsInput0)
			0 (M.L.nuntius_printer_showUiElementsInput1)
			0 (M.L.nuntius_printer_showUiElementsInput2)
			0 (M.L.nuntius_printer_showUiElementsNumpad)
			0 (M.L.nuntius_printer_showUiElementsLoadingInfo)
			0 (M.L.nuntius_printer_showUiElementsAnnouncements)
			1 (M.L.nuntius_printer_showUiConfirmNextTrip)
			0 (M.L.nuntius_printer_showUiMenuNav)
			0 (M.L.nuntius_printer_showUiBusstopDistance)
			
			0 (S.L.nuntius_printer_InputFieldCount)
			0 (S.L.nuntius_printer_currentInputField)
			0 (S.L.nuntius_printer_inputFieldsEnabled)
		{endif}

'20: Menu
		l0 20 =
		{if}
			(L.$.nuntius_printer_currentDisplayTextureFolder)
			(L.L.nuntius_printer_colorSchemeSetting) 0 = {if} "Menu_Apperance_ThemeAuto.dds" {else} "Menu_Apperance_ThemeManual.dds" {endif} $+ (S.$.nuntius_printer_ui_texture)
			(L.$.nuntius_printer_currentDisplayTextureFolder)  "textColor\ConfirmNextTrip.dds" $+ (S.$.nuntius_printer_ui_textColorTexture)
			
			0 (M.L.nuntius_printer_showUiElementsCompanyLogo)
			1 (M.L.nuntius_printer_showUiElementsTime)
			1 (M.L.nuntius_printer_showUiElementsDelay)
			1 (M.L.nuntius_printer_showUiElementsLineInformation)
			0 (M.L.nuntius_printer_showUiElementsBusstopList)
			0 (M.L.nuntius_printer_showUiElementsHomeButtons)
			1 (M.L.nuntius_printer_showUiElementsButtonBack)
			0 (M.L.nuntius_printer_showUiElementsButtonApply)
			0 (M.L.nuntius_printer_showUiElementsButtonReset)
			0 (M.L.nuntius_printer_showUiElementsButtonAuto)
			1 (M.L.nuntius_printer_showUiElementsButtonMenu)
			0 (M.L.nuntius_printer_showUiElementsButtonBusstopMenu)
			0 (M.L.nuntius_printer_showUiElementsTicketList)
			0 (M.L.nuntius_printer_showUiElementsTicketSelection)
			0 (M.L.nuntius_printer_showUiElementsBusstopFooter)
			0 (M.L.nuntius_printer_showUiElementsInput0)
			0 (M.L.nuntius_printer_showUiElementsInput1)
			0 (M.L.nuntius_printer_showUiElementsInput2)
			0 (M.L.nuntius_printer_showUiElementsNumpad)
			0 (M.L.nuntius_printer_showUiElementsLoadingInfo)
			0 (M.L.nuntius_printer_showUiElementsAnnouncements)
			0 (M.L.nuntius_printer_showUiConfirmNextTrip)
			1 (M.L.nuntius_printer_showUiMenuNav)
			1 (M.L.nuntius_printer_showUiMenuAppearance)
			1 (M.L.nuntius_printer_showUiBusstopDistance)
			
			0 (S.L.nuntius_printer_InputFieldCount)
			0 (S.L.nuntius_printer_currentInputField)
			0 (S.L.nuntius_printer_inputFieldsEnabled)
		{endif}

'98: Bad Input
		l0 98 =
		{if}
			(L.$.nuntius_printer_currentDisplayTextureFolder) "Bad_Input.dds" $+ (S.$.nuntius_printer_ui_texture)
			(L.$.nuntius_printer_currentDisplayTextureFolder)  "textColor\Input.dds" $+ (S.$.nuntius_printer_ui_textColorTexture)
			
			0 (M.L.nuntius_printer_showUiElementsCompanyLogo)
			1 (M.L.nuntius_printer_showUiElementsTime)
'			1 (M.L.nuntius_printer_showUiElementsDelay)
'			1 (M.L.nuntius_printer_showUiElementsLineInformation)
			0 (M.L.nuntius_printer_showUiElementsBusstopList)
			0 (M.L.nuntius_printer_showUiElementsHomeButtons)
			0 (M.L.nuntius_printer_showUiElementsButtonBack)
			1 (M.L.nuntius_printer_showUiElementsButtonApply)
			0 (M.L.nuntius_printer_showUiElementsButtonReset)
			0 (M.L.nuntius_printer_showUiElementsButtonAuto)
			0 (M.L.nuntius_printer_showUiElementsButtonMenu)
			0 (M.L.nuntius_printer_showUiElementsButtonBusstopMenu)
			0 (M.L.nuntius_printer_showUiElementsTicketList)
			0 (M.L.nuntius_printer_showUiElementsTicketSelection)
			0 (M.L.nuntius_printer_showUiElementsBusstopFooter)
			0 (M.L.nuntius_printer_showUiElementsInput0)
			0 (M.L.nuntius_printer_showUiElementsInput1)
			0 (M.L.nuntius_printer_showUiElementsInput2)
			0 (M.L.nuntius_printer_showUiElementsNumpad)
			1 (M.L.nuntius_printer_showUiElementsLoadingInfo)
			0 (M.L.nuntius_printer_showUiElementsAnnouncements)
			0 (M.L.nuntius_printer_showUiConfirmNextTrip)
			0 (M.L.nuntius_printer_showUiMenuNav)
			0 (M.L.nuntius_printer_showUiMenuAppearance)
			0 (M.L.nuntius_printer_showUiBusstopDistance)
			
			0 (S.L.nuntius_printer_InputFieldCount)
			0 (S.L.nuntius_printer_currentInputField)
			0 (S.L.nuntius_printer_inputFieldsEnabled)
		{endif}

'99: Please Wait
		l0 99 =
		{if}
			(L.$.nuntius_printer_currentDisplayTextureFolder) "Please_wait.dds" $+ (S.$.nuntius_printer_ui_texture)
			(L.$.nuntius_printer_currentDisplayTextureFolder)  "textColor\Input.dds" $+ (S.$.nuntius_printer_ui_textColorTexture)
			
			0 (M.L.nuntius_printer_showUiElementsCompanyLogo)
			1 (M.L.nuntius_printer_showUiElementsTime)
'			1 (M.L.nuntius_printer_showUiElementsDelay)
'			1 (M.L.nuntius_printer_showUiElementsLineInformation)
			0 (M.L.nuntius_printer_showUiElementsBusstopList)
			0 (M.L.nuntius_printer_showUiElementsHomeButtons)
			0 (M.L.nuntius_printer_showUiElementsButtonBack)
			0 (M.L.nuntius_printer_showUiElementsButtonApply)
			0 (M.L.nuntius_printer_showUiElementsButtonReset)
			0 (M.L.nuntius_printer_showUiElementsButtonAuto)
			0 (M.L.nuntius_printer_showUiElementsButtonMenu)
			0 (M.L.nuntius_printer_showUiElementsButtonBusstopMenu)
			0 (M.L.nuntius_printer_showUiElementsTicketList)
			0 (M.L.nuntius_printer_showUiElementsTicketSelection)
			0 (M.L.nuntius_printer_showUiElementsBusstopFooter)
			0 (M.L.nuntius_printer_showUiElementsInput0)
			0 (M.L.nuntius_printer_showUiElementsInput1)
			0 (M.L.nuntius_printer_showUiElementsInput2)
			0 (M.L.nuntius_printer_showUiElementsNumpad)
			1 (M.L.nuntius_printer_showUiElementsLoadingInfo)
			0 (M.L.nuntius_printer_showUiElementsAnnouncements)
			0 (M.L.nuntius_printer_showUiConfirmNextTrip)
			0 (M.L.nuntius_printer_showUiMenuNav)
			0 (M.L.nuntius_printer_showUiMenuAppearance)
			0 (M.L.nuntius_printer_showUiBusstopDistance)
			
			0 (S.L.nuntius_printer_InputFieldCount)
			0 (S.L.nuntius_printer_currentInputField)
			0 (S.L.nuntius_printer_inputFieldsEnabled)
		{endif}
	{endif}
{end}

'Resets all input fields
{macro:nuntius_printer_resetInputFields}
	""
	(S.$.nuntius_printer_ui_input0)
	(S.$.nuntius_printer_ui_input1)
	(S.$.nuntius_printer_ui_input2)
	(S.$.nuntius_printer_ui_currentTicketName)
	(S.$.nuntius_printer_ui_currentTicketPrice)
{end}


'################################
'User Interface
'################################

{macro:nuntius_printer_hideAllUiElements}
	0
	(S.L.nuntius_printer_visTime)
	(S.L.nuntius_printer_visDelay)
	(S.L.nuntius_printer_visLineInformation)
	(S.L.nuntius_printer_visBusstopList)
	(S.L.nuntius_printer_visHomeButtons)
	(S.L.nuntius_printer_visButtonApply)
	(S.L.nuntius_printer_visButtonReset)
	(S.L.nuntius_printer_visButtonAuto)
	(S.L.nuntius_printer_visButtonBack)
	(S.L.nuntius_printer_visButtonMenu)
	(S.L.nuntius_printer_visButtonBusstopMenu)
	(S.L.nuntius_printer_visInput0)
	(S.L.nuntius_printer_visInput1)
	(S.L.nuntius_printer_visInput2)
	(S.L.nuntius_printer_visNumpad)
	(S.L.nuntius_printer_visLoadingInfo)
	(S.L.nuntius_printer_visTicketList)
	(S.L.nuntius_printer_visTicketSelection)
	(S.L.nuntius_printer_visBusstopFooter)
	(S.L.nuntius_printer_visAnnouncements)
	(S.L.nuntius_printer_visPleaseWait)
{end}

{macro:nuntius_printer_showUiElementsCompanyLogo}
	(S.L.nuntius_printer_visCompanyLogo)
{end}

{macro:nuntius_printer_showUiElementsTime}
	(S.L.nuntius_printer_visTime)
{end}

{macro:nuntius_printer_showUiElementsDelay}
	(S.L.nuntius_printer_visDelay)
{end}

{macro:nuntius_printer_showUiElementsLineInformation}
	(S.L.nuntius_printer_visLineInformation)
{end}

{macro:nuntius_printer_showUiElementsBusstopList}
	(S.L.nuntius_printer_visBusstopList)
{end}

{macro:nuntius_printer_showUiElementsHomeButtons}
	(S.L.nuntius_printer_visHomeButtons)
{end}

{macro:nuntius_printer_showUiElementsInput0}
	(S.L.nuntius_printer_visInput0)
{end}

{macro:nuntius_printer_showUiElementsInput1}
	(S.L.nuntius_printer_visInput1)
{end}

{macro:nuntius_printer_showUiElementsInput2}
	(S.L.nuntius_printer_visInput2)
{end}

{macro:nuntius_printer_showUiElementsNumpad}
	(S.L.nuntius_printer_visNumpad)
{end}

{macro:nuntius_printer_showUiElementsLoadingInfo}
	(S.L.nuntius_printer_visLoadingInfo)
{end}

{macro:nuntius_printer_showUiElementsTicketList}
	(S.L.nuntius_printer_visTicketList)
{end}

{macro:nuntius_printer_showUiElementsTicketSelection}
	(S.L.nuntius_printer_visTicketSelection)
{end}

{macro:nuntius_printer_showUiElementsBusstopFooter}
	(S.L.nuntius_printer_visBusstopFooter)
{end}

{macro:nuntius_printer_showUiElementsButtonBack}
	(S.L.nuntius_printer_visButtonBack)
{end}

{macro:nuntius_printer_showUiElementsButtonApply}
	(S.L.nuntius_printer_visButtonApply)
{end}

{macro:nuntius_printer_showUiElementsButtonReset}
	(S.L.nuntius_printer_visButtonReset)
{end}

{macro:nuntius_printer_showUiElementsButtonAuto}
	(S.L.nuntius_printer_visButtonAuto)
{end}

{macro:nuntius_printer_showUiElementsButtonMenu}
	(S.L.nuntius_printer_visButtonMenu)
{end}

{macro:nuntius_printer_showUiElementsButtonBusstopMenu}
	(S.L.nuntius_printer_visButtonBusstopMenu)
{end}

{macro:nuntius_printer_showUiElementsAnnouncements}
	(S.L.nuntius_printer_visAnnouncements)
{end}

{macro:nuntius_printer_showUiElementsPleaseWait}
	(S.L.nuntius_printer_visPleaseWait)
{end}

{macro:nuntius_printer_showUiConfirmNextTrip}
	(S.L.nuntius_printer_visConfirmNextTrip)
{end}

{macro:nuntius_printer_showUiMenuNav}
	(S.L.nuntius_printer_visMenuNav)
	0 =
	{if}
		0 (M.L.nuntius_printer_showUiMenuAppearance)
	{endif}
{end}

{macro:nuntius_printer_showUiMenuAppearance}
	(S.L.nuntius_printer_visMenuAppearance)
{end}

{macro:nuntius_printer_showUiBusstopDistance}
	(S.L.nuntius_printer_visBusstopDistance)
{end}



'################################
'Sounds
'################################

{macro:nuntius_printer_playSoundNormal}
	(L.L.nuntius_printer_screenSoundIsActive)
	{if}
		(T.L.nuntius_printer_normal)
	{endif}
{end}

{macro:nuntius_printer_playSoundError}
	(L.L.nuntius_printer_screenSoundIsActive)
	{if}
		(T.L.nuntius_printer_error)
	{endif}
{end}

{macro:nuntius_printer_scheduleScriptTextForUpdate}
	2 (S.L.nuntius_printer_updateScriptTexture)
{end}

'################################
'General Tools/Utilities
'################################

'Shortens a string to a maximum length of pixels
'Arguments:
'1 = font index
'0 = maximum length (= field width)
'string0 = the string to modify
{macro:nuntius_printer_shortenString}
'Register use:
'0 = maximum length
'1 = font index
'2 = width of one full stop (".")

	s0

'get back the font index by adding the two top stack values and than subtracting the first one
	+ l0 - s1
	(S.$.nuntius_printer_tmpStr1)
	l1 (M.V.TextLength) l0 <= !
	{if}
'subtract width of full stop ("."), because it will be added again after all
		"." (M.V.TextLength) s2
		l0 l2 - s0

		(M.L.nuntius_printer_shortenString_checkPresets)

		(L.$.nuntius_printer_tmpStr1) l1 (M.V.TextLength) l0 <= ! {if} (M.L.nuntius_printer_shortenString_loop) {endif}
		(L.$.nuntius_printer_tmpStr1) l1 (M.V.TextLength) l0 <= ! {if} (M.L.nuntius_printer_shortenString_loop) {endif}
		(L.$.nuntius_printer_tmpStr1) l1 (M.V.TextLength) l0 <= ! {if} (M.L.nuntius_printer_shortenString_loop) {endif}
		(L.$.nuntius_printer_tmpStr1) l1 (M.V.TextLength) l0 <= ! {if} (M.L.nuntius_printer_shortenString_loop) {endif}
		(L.$.nuntius_printer_tmpStr1) l1 (M.V.TextLength) l0 <= ! {if} (M.L.nuntius_printer_shortenString_loop) {endif}
		(L.$.nuntius_printer_tmpStr1) l1 (M.V.TextLength) l0 <= ! {if} (M.L.nuntius_printer_shortenString_loop) {endif}
		(L.$.nuntius_printer_tmpStr1) l1 (M.V.TextLength) l0 <= ! {if} (M.L.nuntius_printer_shortenString_loop) {endif}
		(L.$.nuntius_printer_tmpStr1) l1 (M.V.TextLength) l0 <= ! {if} (M.L.nuntius_printer_shortenString_loop) {endif}
		(L.$.nuntius_printer_tmpStr1) l1 (M.V.TextLength) l0 <= ! {if} (M.L.nuntius_printer_shortenString_loop) {endif}
		(L.$.nuntius_printer_tmpStr1) l1 (M.V.TextLength) l0 <= ! {if} (M.L.nuntius_printer_shortenString_loop) {endif}

' add "." and finished, but only if it does not end with ")"
		(L.$.nuntius_printer_tmpStr1) 1 $SetLengthR ")" $= !
		{if}
			(L.$.nuntius_printer_tmpStr1) "." $+ (S.$.nuntius_printer_tmpStr1)
		{else}
			(L.$.nuntius_printer_tmpStr1)
		{endif}
	{else}
		(L.$.nuntius_printer_tmpStr1)
	{endif}
{end}

{macro:nuntius_printer_shortenString_checkPresets}
	(L.$.nuntius_printer_tmpStr1) 6 $SetLengthR "Straße" $= {if}        (L.$.nuntius_printer_tmpStr1) 3 $cutEnd (S.$.nuntius_printer_tmpStr1) {endif}
	(L.$.nuntius_printer_tmpStr1) 6 $SetLengthR "straße" $= {if}        (L.$.nuntius_printer_tmpStr1) 3 $cutEnd (S.$.nuntius_printer_tmpStr1) {endif}
	(L.$.nuntius_printer_tmpStr1) 6 $SetLengthR "STRAßE" $= {if}        (L.$.nuntius_printer_tmpStr1) 3 $cutEnd (S.$.nuntius_printer_tmpStr1) {endif}

	(L.$.nuntius_printer_tmpStr1) 7 $SetLengthR "Strasse" $= {if}       (L.$.nuntius_printer_tmpStr1) 4 $cutEnd (S.$.nuntius_printer_tmpStr1) {endif}
	(L.$.nuntius_printer_tmpStr1) 7 $SetLengthR "strasse" $= {if}       (L.$.nuntius_printer_tmpStr1) 4 $cutEnd (S.$.nuntius_printer_tmpStr1) {endif}
	(L.$.nuntius_printer_tmpStr1) 7 $SetLengthR "STRASSE" $= {if}       (L.$.nuntius_printer_tmpStr1) 4 $cutEnd (S.$.nuntius_printer_tmpStr1) {endif}

	(L.$.nuntius_printer_tmpStr1) 3 $SetLengthR "Weg" $= {if}           (L.$.nuntius_printer_tmpStr1) 2 $cutEnd (S.$.nuntius_printer_tmpStr1) {endif}
	(L.$.nuntius_printer_tmpStr1) 3 $SetLengthR "weg" $= {if}           (L.$.nuntius_printer_tmpStr1) 2 $cutEnd (S.$.nuntius_printer_tmpStr1) {endif}
	(L.$.nuntius_printer_tmpStr1) 3 $SetLengthR "WEG" $= {if}           (L.$.nuntius_printer_tmpStr1) 2 $cutEnd (S.$.nuntius_printer_tmpStr1) {endif}

	(L.$.nuntius_printer_tmpStr1) 5 $SetLengthR "Platz" $= {if}         (L.$.nuntius_printer_tmpStr1) 3 $cutEnd (S.$.nuntius_printer_tmpStr1) {endif}
	(L.$.nuntius_printer_tmpStr1) 5 $SetLengthR "platz" $= {if}         (L.$.nuntius_printer_tmpStr1) 3 $cutEnd (S.$.nuntius_printer_tmpStr1) {endif}
	(L.$.nuntius_printer_tmpStr1) 5 $SetLengthR "PLATZ" $= {if}         (L.$.nuntius_printer_tmpStr1) 3 $cutEnd (S.$.nuntius_printer_tmpStr1) {endif}

	(L.$.nuntius_printer_tmpStr1) 5 $SetLengthR "Markt" $= {if}         (L.$.nuntius_printer_tmpStr1) 4 $cutEnd (S.$.nuntius_printer_tmpStr1) {endif}
	(L.$.nuntius_printer_tmpStr1) 5 $SetLengthR "markt" $= {if}         (L.$.nuntius_printer_tmpStr1) 4 $cutEnd (S.$.nuntius_printer_tmpStr1) {endif}
	(L.$.nuntius_printer_tmpStr1) 5 $SetLengthR "MARKT" $= {if}         (L.$.nuntius_printer_tmpStr1) 4 $cutEnd (S.$.nuntius_printer_tmpStr1) {endif}

	(L.$.nuntius_printer_tmpStr1) 5 $SetLengthR "Allee" $= {if}         (L.$.nuntius_printer_tmpStr1) 3 $cutEnd (S.$.nuntius_printer_tmpStr1) {endif}
	(L.$.nuntius_printer_tmpStr1) 5 $SetLengthR "allee" $= {if}         (L.$.nuntius_printer_tmpStr1) 3 $cutEnd (S.$.nuntius_printer_tmpStr1) {endif}
	(L.$.nuntius_printer_tmpStr1) 5 $SetLengthR "ALLEE" $= {if}         (L.$.nuntius_printer_tmpStr1) 3 $cutEnd (S.$.nuntius_printer_tmpStr1) {endif}

	(L.$.nuntius_printer_tmpStr1) 7 $SetLengthR "Bahnhof" $= {if}       (L.$.nuntius_printer_tmpStr1) 7 $cutEnd "Bhf" $+ (S.$.nuntius_printer_tmpStr1) {endif}
	(L.$.nuntius_printer_tmpStr1) 7 $SetLengthR "bahnhof" $= {if}       (L.$.nuntius_printer_tmpStr1) 7 $cutEnd "bhf" $+ (S.$.nuntius_printer_tmpStr1) {endif}
	(L.$.nuntius_printer_tmpStr1) 7 $SetLengthR "BAHNHOF" $= {if}       (L.$.nuntius_printer_tmpStr1) 7 $cutEnd "BHF" $+ (S.$.nuntius_printer_tmpStr1) {endif}

	(L.$.nuntius_printer_tmpStr1) 12 $SetLengthR "Hauptbahnhof" $= {if} (L.$.nuntius_printer_tmpStr1) 12 $cutEnd "Hbf" $+ (S.$.nuntius_printer_tmpStr1) {endif}
	(L.$.nuntius_printer_tmpStr1) 12 $SetLengthR "hauptbahnhof" $= {if} (L.$.nuntius_printer_tmpStr1) 12 $cutEnd "hbf" $+ (S.$.nuntius_printer_tmpStr1) {endif}
	(L.$.nuntius_printer_tmpStr1) 12 $SetLengthR "HAUPTBAHNHOF" $= {if} (L.$.nuntius_printer_tmpStr1) 12 $cutEnd "HBF" $+ (S.$.nuntius_printer_tmpStr1) {endif}

	(L.$.nuntius_printer_tmpStr1) 7 $SetLengthR "Ankunft" $= {if}       (L.$.nuntius_printer_tmpStr1) 5 $cutEnd (S.$.nuntius_printer_tmpStr1) {endif}
	(L.$.nuntius_printer_tmpStr1) 7 $SetLengthR "ankunft" $= {if}       (L.$.nuntius_printer_tmpStr1) 5 $cutEnd (S.$.nuntius_printer_tmpStr1) {endif}
	(L.$.nuntius_printer_tmpStr1) 7 $SetLengthR "ANKUNFT" $= {if}       (L.$.nuntius_printer_tmpStr1) 5 $cutEnd (S.$.nuntius_printer_tmpStr1) {endif}

	(L.$.nuntius_printer_tmpStr1) 9 $SetLengthR "(Ankunft)" $= {if}     (L.$.nuntius_printer_tmpStr1) 9 $cutEnd "(An)" $+ (S.$.nuntius_printer_tmpStr1) {endif}
	(L.$.nuntius_printer_tmpStr1) 9 $SetLengthR "(ankunft)" $= {if}     (L.$.nuntius_printer_tmpStr1) 9 $cutEnd "(an)" $+ (S.$.nuntius_printer_tmpStr1) {endif}
	(L.$.nuntius_printer_tmpStr1) 9 $SetLengthR "(ANKUNFT)" $= {if}     (L.$.nuntius_printer_tmpStr1) 9 $cutEnd "(AN)" $+ (S.$.nuntius_printer_tmpStr1) {endif}

	(L.$.nuntius_printer_tmpStr1) 7 $SetLengthR "Abfahrt" $= {if}       (L.$.nuntius_printer_tmpStr1) 5 $cutEnd (S.$.nuntius_printer_tmpStr1) {endif}
	(L.$.nuntius_printer_tmpStr1) 7 $SetLengthR "abfahrt" $= {if}       (L.$.nuntius_printer_tmpStr1) 5 $cutEnd (S.$.nuntius_printer_tmpStr1) {endif}
	(L.$.nuntius_printer_tmpStr1) 7 $SetLengthR "ABFAHRT" $= {if}       (L.$.nuntius_printer_tmpStr1) 5 $cutEnd (S.$.nuntius_printer_tmpStr1) {endif}

	(L.$.nuntius_printer_tmpStr1) 9 $SetLengthR "(Abfahrt)" $= {if}     (L.$.nuntius_printer_tmpStr1) 9 $cutEnd "(Ab)" $+ (S.$.nuntius_printer_tmpStr1) {endif}
	(L.$.nuntius_printer_tmpStr1) 9 $SetLengthR "(abfahrt)" $= {if}     (L.$.nuntius_printer_tmpStr1) 9 $cutEnd "(ab)" $+ (S.$.nuntius_printer_tmpStr1) {endif}
	(L.$.nuntius_printer_tmpStr1) 9 $SetLengthR "(ABFAHRT)" $= {if}     (L.$.nuntius_printer_tmpStr1) 9 $cutEnd "(AB)" $+ (S.$.nuntius_printer_tmpStr1) {endif}
{end}

{macro:nuntius_printer_shortenString_loop}
	(M.L.nuntius_printer_shortenString_removeOneChar)
	(M.L.nuntius_printer_shortenString_removeOneChar)
	(M.L.nuntius_printer_shortenString_removeOneChar)
	(M.L.nuntius_printer_shortenString_removeOneChar)
	(M.L.nuntius_printer_shortenString_removeOneChar)
	(M.L.nuntius_printer_shortenString_removeOneChar)
	(M.L.nuntius_printer_shortenString_removeOneChar)
	(M.L.nuntius_printer_shortenString_removeOneChar)
	(M.L.nuntius_printer_shortenString_removeOneChar)
	(M.L.nuntius_printer_shortenString_removeOneChar)
{end}

{macro:nuntius_printer_shortenString_removeOneChar}
	(L.$.nuntius_printer_tmpStr1)
	l1 (M.V.TextLength) l0 <= !
	{if} (L.$.nuntius_printer_tmpStr1) 1 $cutEnd (S.$.nuntius_printer_tmpStr1) {endif}
{end}
